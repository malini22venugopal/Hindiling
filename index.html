<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>рд╣рд┐рдВрджреА рдСрдбрд┐рдпреЛ рдХреНрд╡рд┐рдЬрд╝ тАФ рд▓рд┐рдВрдЧ & рд╡рдЪрди (30 рдкреНрд░рд╢реНрди)</title>
<style>
  body{font-family:'Noto Sans Devanagari',sans-serif;background:#fffdf9;margin:0;padding:20px;text-align:center}
  h1{color:#b71c1c}
  #questionText{font-size:1.5em;margin:25px 0}
  input{padding:10px;font-size:1.1em;width:80%;max-width:320px;border:2px solid #ccc;border-radius:10px;text-align:center}
  button{margin:6px;padding:10px 15px;border:none;border-radius:8px;background:#1565c0;color:#fff;font-size:1em}
  button:hover{background:#0d47a1}
  #feedbackText{margin-top:10px;font-size:1.2em;font-weight:bold}
  #score{font-size:1.3em;margin-top:20px;color:#00695c}
</style>
</head>
<body>
<h1>рд╣рд┐рдВрджреА рдСрдбрд┐рдпреЛ рдХреНрд╡рд┐рдЬрд╝ тАФ рд▓рд┐рдВрдЧ & рд╡рдЪрди</h1>
<div id="questionText">рдХреНрд╡рд┐рдЬрд╝ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ</div>
<input id="answerInput" placeholder="рдЙрддреНрддрд░ рдмреЛрд▓реЗрдВ рдпрд╛ рд▓рд┐рдЦреЗрдВ"/>
<div>
  <button id="submitBtn">рдЬрд╛рдБрдЪреЗрдВ</button>
  <button id="speakBtn">ЁЯОЩя╕П рдмреЛрд▓реЗрдВ</button>
  <button id="passBtn">рдкрд╛рд╕</button>
  <button id="replayBtn">ЁЯФБ рджреЛрд╣рд░рд╛рдПрдБ</button>
</div>
<div><button id="playBtn">тЦ╢я╕П рд╢реБрд░реВ рдХрд░реЗрдВ</button></div>
<div id="feedbackText"></div>
<div id="status"></div>
<div id="score"></div>

<script>
const vachanQuestions=[
  {word:"рдкрд╛рдард╢рд╛рд▓рд╛",answers:["рдкрд╛рдард╢рд╛рд▓рд╛рдПрдБ","рдкрд╛рдард╢рд╛рд▓рд╛рдПрдВ"]},
  {word:"рдорд╛рд▓рд╛",answers:["рдорд╛рд▓рд╛рдПрдБ","рдорд╛рд▓рд╛рдПрдВ"]},
  {word:"рдЪрд┐рдбрд╝рд┐рдпрд╛",answers:["рдЪрд┐рдбрд╝рд┐рдпрд╛рдПрдБ","рдЪрд┐рдбрд╝рд┐рдпрд╛рдПрдВ"]},
  {word:"рдЧреБрдбрд╝рд┐рдпрд╛",answers:["рдЧреБрдбрд╝рд┐рдпрд╛рдБ","рдЧреБрдбрд╝рд┐рдпрд╛рдВ"]},
  {word:"рд▓рдбрд╝рдХреА",answers:["рд▓рдбрд╝рдХрд┐рдпрд╛рдБ","рд▓рдбрд╝рдХрд┐рдпрд╛рдВ"]},
  {word:"рдирджреА",answers:["рдирджрд┐рдпрд╛рдБ","рдирджрд┐рдпрд╛рдВ"]},
  {word:"рд░реЛрдЯреА",answers:["рд░реЛрдЯрд┐рдпрд╛рдБ","рд░реЛрдЯрд┐рдпрд╛рдВ"]},
  {word:"рдЧрд╛рдбрд╝реА",answers:["рдЧрд╛рдбрд╝рд┐рдпрд╛рдБ","рдЧрд╛рдбрд╝рд┐рдпреЛрдВ"]},
  {word:"рдХреБрд░реНрд╕реА",answers:["рдХреБрд░реНрд╕рд┐рдпрд╛рдБ","рдХреБрд░реНрд╕рд┐рдпрд╛рдВ"]},
  {word:"рдХрд┐рддрд╛рдм",answers:["рдХрд┐рддрд╛рдмреЗрдВ","рдХрд┐рддрд╛рдмреЛрдВ"]},
  {word:"рд▓рдбрд╝рдХрд╛",answers:["рд▓рдбрд╝рдХреЗ","рд▓рдбрд╝рдХреЗрдВ"]},
  {word:"рд░реБрдкрдпрд╛",answers:["рд░реБрдкрдпреЗ","рд░реБрдкрдП"]},
  {word:"рдХрдорд░рд╛",answers:["рдХрдорд░реЗ","рдХрдорд░реЛрдВ"]},
  {word:"рддрд╕реНрд╡реАрд░",answers:["рддрд╕реНрд╡реАрд░реЗрдВ","рддрд╕реНрд╡реАрд░реЛрдВ"]},
  {word:"рд╕реЗрдм",answers:["рд╕реЗрдм","рд╕реЗрдмреЛрдВ"]}
];

const lingQuestions=[
  {word:"рд░рд╛рдЬрд╛",male:["рд░рд╛рдЬрд╛"],female:["рд░рд╛рдиреА"]},
  {word:"рд░рд╛рдиреА",male:["рд░рд╛рдЬрд╛"],female:["рд░рд╛рдиреА"]},
  {word:"рд╢реЗрд░",male:["рд╢реЗрд░"],female:["рд╢реЗрд░рдиреА"]},
  {word:"рд╢реЗрд░рдиреА",male:["рд╢реЗрд░"],female:["рд╢реЗрд░рдиреА"]},
  {word:"рдкрддрд┐",male:["рдкрддрд┐"],female:["рдкрддреНрдиреА"]},
  {word:"рдкрддреНрдиреА",male:["рдкрддрд┐"],female:["рдкрддреНрдиреА"]},
  {word:"рдирд╛рдирд╛",male:["рдирд╛рдирд╛"],female:["рдирд╛рдиреА"]},
  {word:"рдирд╛рдиреА",male:["рдирд╛рдирд╛"],female:["рдирд╛рдиреА"]},
  {word:"рдореБрд░реНрдЧрд╛",male:["рдореБрд░реНрдЧрд╛"],female:["рдореБрд░реНрдЧреА"]},
  {word:"рдореБрд░реНрдЧреА",male:["рдореБрд░реНрдЧрд╛"],female:["рдореБрд░реНрдЧреА"]},
  {word:"рдкреБрддреНрд░",male:["рдкреБрддреНрд░"],female:["рдкреБрддреНрд░реА"]},
  {word:"рдкреБрддреНрд░реА",male:["рдкреБрддреНрд░"],female:["рдкреБрддреНрд░реА"]},
  {word:"рдЕрдзреНрдпрд╛рдкрдХ",male:["рдЕрдзреНрдпрд╛рдкрдХ"],female:["рдЕрдзреНрдпрд╛рдкрд┐рдХрд╛"]},
  {word:"рдЕрдзреНрдпрд╛рдкрд┐рдХрд╛",male:["рдЕрдзреНрдпрд╛рдкрдХ"],female:["рдЕрдзреНрдпрд╛рдкрд┐рдХрд╛"]},
  {word:"рд╕реЗрда",male:["рд╕реЗрда"],female:["рд╕реЗрдард╛рдиреА","рд╕реЗрдардиреА"]}
];

let questions=[];
vachanQuestions.forEach(q=>questions.push({type:"vachan",...q}));
lingQuestions.forEach(q=>questions.push({type:"ling",...q}));
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}
shuffle(questions);

let current=0,score=0,lastSpoken="",recognition=null,voice=null;

function chooseVoice(){
  const v=speechSynthesis.getVoices();
  const hi=v.filter(x=>/hi|hindi/i.test(x.lang||""));
  return hi.find(x=>/female|Aditi|Shruti|Google/.test(x.name))||hi[0]||v[0];
}

function speak(txt,onend){
  lastSpoken=txt;
  const u=new SpeechSynthesisUtterance(txt);
  u.lang="hi-IN";u.rate=0.95;
  if(!voice)voice=chooseVoice();
  if(voice)u.voice=voice;
  if(onend)u.onend=onend;
  speechSynthesis.cancel();speechSynthesis.speak(u);
}

function normalize(s){return (s||"").normalize("NFD").replace(/[\u093C-\u094D\u0964-\u0965\s\p{P}]/gu,"").toLowerCase();}
function lev(a,b){if(a===b)return 0;let m=[],al=a.length,bl=b.length;
  for(let i=0;i<=al;i++){m[i]=[i];for(let j=1;j<=bl;j++)m[i][j]=i===0?j:0;}
  for(let i=1;i<=al;i++){for(let j=1;j<=bl;j++){m[i][j]=a[i-1]===b[j-1]?m[i-1][j-1]:Math.min(m[i-1][j]+1,m[i][j-1]+1,m[i-1][j-1]+1);}}return m[al][bl];}
function match(a,b){a=normalize(a);b=normalize(b);if(a===b)return true;return lev(a,b)<=Math.max(1,Math.floor(Math.max(a.length,b.length)*0.25));}

const qText=document.getElementById("questionText");
const ans=document.getElementById("answerInput");
const submitBtn=document.getElementById("submitBtn");
const passBtn=document.getElementById("passBtn");
const replayBtn=document.getElementById("replayBtn");
const speakBtn=document.getElementById("speakBtn");
const playBtn=document.getElementById("playBtn");
const scoreDiv=document.getElementById("score");
const feedback=document.getElementById("feedbackText");
const status=document.getElementById("status");

function nextQ(){
  if(current>=questions.length)return endQuiz();
  const q=questions[current];
  let prompt,expected;
  if(q.type==="vachan"){prompt=`рд╡рдЪрди рдмрджрд▓рд┐рдП: ${q.word} рдХрд╛ рдмрд╣реБрд╡рдЪрди рдмрддрд╛рдЗрдП`;expected=q.answers;}
  else{
    if(["рд░рд╛рдиреА","рд╢реЗрд░рдиреА","рдкрддреНрдиреА","рдирд╛рдиреА","рдореБрд░реНрдЧреА","рдкреБрддреНрд░реА","рдЕрдзреНрдпрд╛рдкрд┐рдХрд╛"].includes(q.word)){
      prompt=`рд▓рд┐рдВрдЧ рдмрджрд▓рд┐рдП: ${q.word} рдХрд╛ рдкреБрд▓реНрд▓рд┐рдВрдЧ рдмрддрд╛рдЗрдП`;expected=q.male;
    }else{
      prompt=`рд▓рд┐рдВрдЧ рдмрджрд▓рд┐рдП: ${q.word} рдХрд╛ рд╕реНрддреНрд░реАрд▓рд┐рдВрдЧ рдмрддрд╛рдЗрдП`;expected=q.female;
    }
  }
  q._expected=expected;
  qText.textContent=prompt;ans.value="";feedback.textContent="";
  ans.disabled=false;submitBtn.disabled=false;passBtn.disabled=false;replayBtn.disabled=false;
  speak(prompt);
}

function correct(){
  score++;
  feedback.textContent="тЬЕ рд╕рд╣реА рдЙрддреНрддрд░!";
  feedback.style.color="#1a7f3a";
  speak("рд╕рд╣реА рдЙрддреНрддрд░");
  setTimeout(()=>{current++;nextQ();},4000); // slower move to next
}

function wrong(){
  feedback.textContent="тЭМ рдЧрд▓рдд рдЙрддреНрддрд░! рдлрд┐рд░ рд╕реЗ рдмреЛрд▓реЗрдВ рдпрд╛ рдкрд╛рд╕ рджрдмрд╛рдПрдБред";
  feedback.style.color="#c00";
  speak("рдЧрд▓рдд рдЙрддреНрддрд░");
}

submitBtn.onclick=()=>{
  const val=ans.value.trim();
  if(!val)return;
  const list=questions[current]._expected;
  if(list.some(x=>match(val,x)))correct();else wrong();
};

passBtn.onclick=()=>{current++;nextQ();};
replayBtn.onclick=()=>{if(lastSpoken)speak(lastSpoken);};

playBtn.onclick=()=>{
  current=0;score=0;
  shuffle(questions);
  qText.textContent="рдЪрд▓реЛ, рд╣рдо рд╣рд┐рдВрджреА рдкреНрд░рд╢реНрдиреЛрддреНрддрд░реА рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ!";
  speak("рдЪрд▓реЛ, рд╣рдо рд╣рд┐рдВрджреА рдкреНрд░рд╢реНрдиреЛрддреНрддрд░реА рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ!",()=>{setTimeout(()=>{nextQ();},1200);});
};

try{
  const R=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(R){
    recognition=new R();recognition.lang="hi-IN";recognition.interimResults=false;recognition.maxAlternatives=1;
    recognition.onresult=e=>{
      const txt=e.results[0][0].transcript.trim();ans.value=txt;
      const list=questions[current]._expected;
      if(list.some(x=>match(txt,x)))correct();else wrong();
    };
    recognition.onerror=e=>{status.textContent="ЁЯОЩя╕П рддреНрд░реБрдЯрд┐: "+e.error;};
    speakBtn.onclick=()=>{status.textContent="ЁЯОЩя╕П рд╕реБрди рд░рд╣рд╛ рд╣реВрдБ";try{recognition.start();}catch{};};
  }
}catch(e){console.warn(e);}

function endQuiz(){
  qText.textContent="рдХреНрд╡рд┐рдЬрд╝ рд╕рдорд╛рдкреНрдд!";
  ans.disabled=true;
  submitBtn.disabled=passBtn.disabled=speakBtn.disabled=replayBtn.disabled=true;
  scoreDiv.textContent=`рдЖрдкрдХрд╛ рд╕реНрдХреЛрд░: ${score} / ${questions.length}`;
  speak(`рдХреНрд╡рд┐рдЬрд╝ рд╕рдорд╛рдкреНрддред рдЖрдкрдХрд╛ рд╕реНрдХреЛрд░ ${score} рдореЗрдВ рд╕реЗ ${questions.length} рд╣реИред`);
}
</script>
</body>
</html>
