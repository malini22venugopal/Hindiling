<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§ë‡§°‡§ø‡§Ø‡•ã ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‚Äî ‡§≤‡§ø‡§Ç‡§ó & ‡§µ‡§ö‡§®</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
<style>
body{font-family:'Noto Sans Devanagari',sans-serif;background:#fffdf9;margin:0;padding:20px;color:#111}
h1{color:#b71c1c;text-align:center;margin:6px 0 18px;font-size:1.9rem}
.center{max-width:760px;margin:0 auto;padding:12px}
.controls{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:12px}
button{border:none;padding:10px 14px;border-radius:8px;font-size:1rem;cursor:pointer}
button.blue{background:#1565c0;color:#fff;box-shadow:0 2px 0 rgba(0,0,0,0.08)}
button.gray{background:#6c757d;color:#fff}
input[type=text]{width:100%;padding:12px;border-radius:8px;border:1px solid #ccc;font-size:1rem;box-sizing:border-box}
#question{text-align:left;font-size:1.6rem;margin:18px 0 8px;color:#333}
#translation{color:#666;margin-bottom:8px}
#feedback{min-height:28px;margin-top:12px;font-weight:700}
#feedback.correct{color:#0b5;display:inline-block}
#feedback.wrong{color:#c00;display:inline-block}
.note{color:#b71c1c;margin-top:18px;font-weight:700}
.small{font-size:0.9rem;color:#666;margin-top:12px;text-align:center}
#loginModal{position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;z-index:999}
.loginBox{background:#fff;padding:20px;border-radius:10px;max-width:360px;width:90%;text-align:center;box-shadow:0 6px 20px rgba(0,0,0,0.2)}
.loginBox input{margin:8px 0;padding:10px;width:80%;border-radius:6px;border:1px solid #ccc;font-size:1rem}
#logoutBtn{background:#b71c1c;color:#fff;margin-top:10px;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
.buttons-row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:12px 0}
</style>
</head>
<body>
<div class="center">
<h1>‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§ë‡§°‡§ø‡§Ø‡•ã ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‚Äî ‡§≤‡§ø‡§Ç‡§ó & ‡§µ‡§ö‡§®</h1>

<!-- LOGIN MODAL -->
<div id="loginModal">
  <div class="loginBox">
    <h3>‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</h3>
    <input id="loginName" type="text" placeholder="‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç (Name)" />
    <div style="margin-top:10px">
      <button id="loginBtn" class="blue">‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
    <p id="loginMsg" style="color:#c00;margin-top:10px"></p>
  </div>
</div>

<!-- QUIZ AREA -->
<div id="quizArea" style="display:none">
  <div id="question">‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è "‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç" ‡§¶‡§¨‡§æ‡§è‡§Å</div>
  <div id="translation">(Listen and answer)</div>
  <input id="answerInput" type="text" placeholder="‡§â‡§§‡•ç‡§§‡§∞ ‡§¨‡•ã‡§≤‡§ø‡§è ‡§Ø‡§æ ‡§≤‡§ø‡§ñ‡§ø‡§è (Enter ‡§∏‡•á ‡§ú‡§æ‡§Å‡§ö‡•á‡§Ç)" />
  <div class="controls buttons-row">
    <button id="speakBtn" class="blue">üé§ ‡§¨‡•ã‡§≤‡•á‡§Ç</button>
    <button id="passBtn" class="gray">‚è≠ ‡§™‡§æ‡§∏</button>
    <button id="replayBtn" class="gray">üîÅ ‡§´‡§ø‡§∞ ‡§∏‡•Å‡§®‡•á‡§Ç</button>
    <button id="checkBtn" class="blue">‚úÖ ‡§ú‡§æ‡§Å‡§ö‡•á‡§Ç</button>
  </div>
  <div id="feedback"></div>
  <div id="score" class="small"></div>
  <button id="logoutBtn">üîí ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§î‡§∞ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§≠‡•á‡§ú‡•á‡§Ç</button>
  <p class="note" id="voiceWarn" style="display:none">üî¥ ‡§Ü‡§™‡§ï‡•á ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Æ‡•á‡§Ç ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§ï‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§∞‡§π‡•Ä ‡§π‡•à‡•§</p>
</div>
</div>

<script>
// ================== Data ==================
const APPS_SCRIPT_URL = "YOUR_APPS_SCRIPT_URL_HERE";
const WHATSAPP_PHONE = "919994895676";

const vachanQuestions=[
  {word:"‡§≤‡§§‡§æ",answers:["‡§≤‡§§‡§æ‡§è‡§Å","‡§≤‡§§‡§æ‡§è‡§Ç"]},
  {word:"‡§Æ‡§æ‡§≤‡§æ",answers:["‡§Æ‡§æ‡§≤‡§æ‡§è‡§Å","‡§Æ‡§æ‡§≤‡§æ‡§è‡§Ç"]},
  {word:"‡§ö‡§ø‡§°‡§º‡§ø‡§Ø‡§æ",answers:["‡§ö‡§ø‡§°‡§º‡§ø‡§Ø‡§æ‡§Å","‡§ö‡§ø‡§°‡§º‡§ø‡§Ø‡§æ‡§è‡§Ç"]},
  {word:"‡§≤‡§°‡§º‡§ï‡•Ä",answers:["‡§≤‡§°‡§º‡§ï‡§ø‡§Ø‡§æ‡§Å","‡§≤‡§°‡§º‡§ï‡§ø‡§Ø‡§æ‡§Ç"]},
  {word:"‡§®‡§¶‡•Ä",answers:["‡§®‡§¶‡§ø‡§Ø‡§æ‡§Å","‡§®‡§¶‡§ø‡§Ø‡§æ‡§Ç"]}
];

const lingQuestions=[
  {word:"‡§∞‡§æ‡§ú‡§æ",male:["‡§∞‡§æ‡§ú‡§æ"],female:["‡§∞‡§æ‡§®‡•Ä"]},
  {word:"‡§∂‡•á‡§∞",male:["‡§∂‡•á‡§∞"],female:["‡§∂‡•á‡§∞‡§®‡•Ä"]},
  {word:"‡§ï‡•Å‡§§‡•ç‡§§‡§æ",male:["‡§ï‡•Å‡§§‡•ç‡§§‡§æ"],female:["‡§ï‡•Å‡§§‡§ø‡§Ø‡§æ"]},
  {word:"‡§ò‡•ã‡§°‡§º‡§æ",male:["‡§ò‡•ã‡§°‡§º‡§æ"],female:["‡§ò‡•ã‡§°‡§º‡•Ä"]}
];

let pool=[];
vachanQuestions.forEach(q=>pool.push({...q,type:'vachan'}));
lingQuestions.forEach(q=>pool.push({...q,type:'ling'}));
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}

// ================== State ==================
let idx=0, score=0, startTime=0;
let started=false;

// ================== Elements ==================
const loginModal=document.getElementById('loginModal');
const loginName=document.getElementById('loginName');
const loginBtn=document.getElementById('loginBtn');
const loginMsg=document.getElementById('loginMsg');
const quizArea=document.getElementById('quizArea');
const questionEl=document.getElementById('question');
const translationEl=document.getElementById('translation');
const answerInput=document.getElementById('answerInput');
const speakBtn=document.getElementById('speakBtn');
const passBtn=document.getElementById('passBtn');
const replayBtn=document.getElementById('replayBtn');
const checkBtn=document.getElementById('checkBtn');
const feedbackEl=document.getElementById('feedback');
const scoreEl=document.getElementById('score');
const logoutBtn=document.getElementById('logoutBtn');
const voiceWarn=document.getElementById('voiceWarn');

// ================== Voice ==================
let chosenVoice=null;
function pickVoice(){
  const voices=speechSynthesis.getVoices();
  if(!voices.length)return null;
  const hi=voices.filter(v=>(v.lang||'').toLowerCase().startsWith('hi'));
  return hi[0]||voices[0];
}
speechSynthesis.onvoiceschanged=()=>{chosenVoice=pickVoice();}
chosenVoice=pickVoice();
function speak(text,cb){
  try{
    speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(text);
    u.lang='hi-IN'; u.rate=0.95;
    if(chosenVoice) u.voice=chosenVoice;
    if(cb) u.onend=cb;
    speechSynthesis.speak(u);
  }catch(e){console.warn(e);}
}

// ================== Utils ==================
function normalize(s){return s?s.toString().normalize('NFD').replace(/[\u093C-\u094D\u0964-\u0965\s\p{P}]/gu,'').toLowerCase():'';}
function matchAnswer(inp,expected){return normalize(inp)===normalize(expected);}

// ================== Show Question ==================
function showQuestion(){
  if(idx>=pool.length){endQuiz(); return;}
  const q=pool[idx];
  if(q.type==='vachan'){
    questionEl.textContent=`‡§µ‡§ö‡§® ‡§¨‡§¶‡§≤‡§ø‡§è: ${q.word} ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è`;
    translationEl.textContent='(Change to plural)';
    q._expected=q.answers;
  }else{
    if(Math.random()<0.5){questionEl.textContent=`‡§≤‡§ø‡§Ç‡§ó ‡§¨‡§¶‡§≤‡§ø‡§è: ${q.word} ‡§ï‡§æ ‡§™‡•Å‡§≤‡•ç‡§≤‡§ø‡§Ç‡§ó ‡§¨‡§§‡§æ‡§á‡§è`; translationEl.textContent='(Change to masculine)'; q._expected=q.male;}
    else{questionEl.textContent=`‡§≤‡§ø‡§Ç‡§ó ‡§¨‡§¶‡§≤‡§ø‡§è: ${q.word} ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§¨‡§§‡§æ‡§á‡§è`; translationEl.textContent='(Change to feminine)'; q._expected=q.female;}
  }
  answerInput.value=''; feedbackEl.textContent='';
  speak(questionEl.textContent);
}

// ================== Check Answer ==================
function checkAnswerInput(userTxt){
  const q=pool[idx];
  if(q._expected.some(e=>matchAnswer(userTxt,e))){
    score++;
    feedbackEl.className='correct'; feedbackEl.textContent='‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‚úì';
    speak('‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞',()=>{idx++; showQuestion();});
  }else{
    feedbackEl.className='wrong'; feedbackEl.textContent='‡§ó‡§≤‡§§ ‡§â‡§§‡•ç‡§§‡§∞ ‚Äî ‡§™‡§æ‡§∏ ‡§¶‡§¨‡§æ‡§è‡§Å ‡§Ø‡§æ ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§≤‡§ø‡§ñ‡•á‡§Ç';
    speak('‡§ó‡§≤‡§§ ‡§â‡§§‡•ç‡§§‡§∞');
  }
}
checkBtn.onclick=()=>{const v=answerInput.value.trim(); if(!v){feedbackEl.textContent='‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç'; return;} checkAnswerInput(v);}
answerInput.addEventListener('keydown',e=>{if(e.key==='Enter') checkBtn.click();});

// ================== Pass / Replay ==================
passBtn.onclick=()=>{idx++; showQuestion();}
replayBtn.onclick=()=>{speak(questionEl.textContent);}

// ================== End Quiz ==================
function endQuiz(){
  questionEl.textContent='‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§!';
  translationEl.textContent='';
  feedbackEl.textContent='';
  scoreEl.textContent=`‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞: ${score}/${pool.length}`;
  speak(`‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡•§ ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞ ${score} ‡§Æ‡•á‡§Ç ‡§∏‡•á ${pool.length} ‡§π‡•à‡•§`);
}

// ================== Login Flow ==================
loginBtn.onclick=()=>{
  const name=loginName.value.trim();
  if(!name){loginMsg.textContent="‡§®‡§æ‡§Æ ‡§°‡§æ‡§≤‡•á‡§Ç"; return;}
  if(localStorage.getItem('quiz_done_for_'+name)){loginMsg.textContent="‡§Ü‡§™ ‡§™‡§π‡§≤‡•á ‡§π‡•Ä ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§¶‡•á ‡§ö‡•Å‡§ï‡•á ‡§π‡•à‡§Ç"; return;}
  localStorage.setItem('quiz_user_name',name);
  loginModal.style.display='none'; quizArea.style.display='block';
  started=true; idx=0; score=0; startTime=Date.now(); shuffle(pool); showQuestion();
};

// ================== Logout ==================
logoutBtn.onclick=()=>{
  const name=localStorage.getItem('quiz_user_name')||'Unknown';
  const total=pool.length;
  localStorage.setItem('quiz_done_for_'+name, JSON.stringify({score,total,time:new Date().toLocaleString()}));
  alert('‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§π‡•Å‡§à‡•§'); location.reload();
};
</script>
</body>
</html>
