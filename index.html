<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>рд╣рд┐рдВрджреА рдСрдбрд┐рдпреЛ рдХреНрд╡рд┐рдЬрд╝ тАФ рд▓рд┐рдВрдЧ & рд╡рдЪрди</title>
<style>
  body{font-family:'Noto Sans Devanagari',sans-serif;background:#fffdf9;margin:0;padding:20px;text-align:center}
  h1{color:#b71c1c}
  #loginScreen,#quizScreen,#resultScreen{display:none}
  input,select{padding:10px;font-size:1.1em;width:80%;max-width:300px;margin:8px;border:2px solid #ccc;border-radius:10px;text-align:center}
  button{margin:6px;padding:10px 15px;border:none;border-radius:8px;background:#1565c0;color:#fff;font-size:1em}
  button:hover{background:#0d47a1}
  #questionText{font-size:1.5em;margin:25px 0}
  #feedbackText{margin-top:10px;font-size:1.2em;font-weight:bold}
  #score{font-size:1.3em;margin-top:20px;color:#00695c}
</style>
</head>
<body>
<h1>рд╣рд┐рдВрджреА рдСрдбрд┐рдпреЛ рдХреНрд╡рд┐рдЬрд╝ тАФ рд▓рд┐рдВрдЧ & рд╡рдЪрди</h1>

<!-- Login Screen -->
<div id="loginScreen">
  <h2>рд▓реЙрдЧрд┐рди рдХрд░реЗрдВ</h2>
  <input id="studentName" placeholder="рдирд╛рдо рд▓рд┐рдЦреЗрдВ"><br>
  <input id="studentClass" placeholder="рдХрдХреНрд╖рд╛ / рд░реЛрд▓ рдирдВрдмрд░"><br>
  <button id="loginBtn">рд╢реБрд░реВ рдХрд░реЗрдВ</button>
  <p id="loginMsg" style="color:red"></p>
</div>

<!-- Quiz Screen -->
<div id="quizScreen">
  <div id="questionText">рдХреНрд╡рд┐рдЬрд╝ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ</div>
  <input id="answerInput" placeholder="рдЙрддреНрддрд░ рд▓рд┐рдЦреЗрдВ рдпрд╛ рдмреЛрд▓реЗрдВ"/>
  <div>
    <button id="submitBtn">рдЬрд╛рдБрдЪреЗрдВ</button>
    <button id="speakBtn">ЁЯОЩя╕П рдмреЛрд▓реЗрдВ</button>
    <button id="passBtn">рдкрд╛рд╕</button>
    <button id="replayBtn">ЁЯФБ рджреЛрд╣рд░рд╛рдПрдБ</button>
  </div>
  <div><button id="playBtn">тЦ╢я╕П рд╢реБрд░реВ рдХрд░реЗрдВ</button></div>
  <div id="feedbackText"></div>
  <div id="status"></div>
  <div id="score"></div>
</div>

<!-- Result Screen -->
<div id="resultScreen">
  <h2>рдХреНрд╡рд┐рдЬрд╝ рд╕рдорд╛рдкреНрдд!</h2>
  <div id="finalScore"></div>
  <button id="sendReportBtn">ЁЯУ▒ WhatsApp рдкрд░ рд░рд┐рдкреЛрд░реНрдЯ рднреЗрдЬреЗрдВ</button>
</div>

<script>
/* ------------------- QUESTIONS ------------------- */
const vachanQuestions = [
  { word: "рдХрд┐рддрд╛рдм", answers:["рдХрд┐рддрд╛рдмреЗрдВ"] },
  { word: "рдирджреА", answers:["рдирджрд┐рдпрд╛рдБ","рдирджрд┐рдпрд╛рдВ"] },
  { word: "рдХреБрд░реНрд╕реА", answers:["рдХреБрд░реНрд╕рд┐рдпрд╛рдБ","рдХреБрд░реНрд╕рд┐рдпрд╛рдВ"] },
  { word: "рдлрд▓", answers:["рдлрд▓"] },
  { word: "рдлреВрд▓", answers:["рдлреВрд▓"] }
];
const lingQuestions = [
  { word: "рд░рд╛рдЬрд╛", male:["рд░рд╛рдЬрд╛"], female:["рд░рд╛рдиреА"] },
  { word: "рд░рд╛рдиреА", male:["рд░рд╛рдЬрд╛"], female:["рд░рд╛рдиреА"] },
  { word: "рд▓рдбрд╝рдХрд╛", male:["рд▓рдбрд╝рдХрд╛"], female:["рд▓рдбрд╝рдХреА"] },
  { word: "рд▓рдбрд╝рдХреА", male:["рд▓рдбрд╝рдХрд╛"], female:["рд▓рдбрд╝рдХреА"] },
  { word: "рдкрддрд┐", male:["рдкрддрд┐"], female:["рдкрддреНрдиреА"] },
  { word: "рдкрддреНрдиреА", male:["рдкрддрд┐"], female:["рдкрддреНрдиреА"] },
  { word: "рд╢реЗрд░", male:["рд╢реЗрд░"], female:["рд╢реЗрд░рдиреА"] },
  { word: "рд╢реЗрд░рдиреА", male:["рд╢реЗрд░"], female:["рд╢реЗрд░рдиреА"] },
  { word: "рдкреБрддреНрд░", male:["рдкреБрддреНрд░"], female:["рдкреБрддреНрд░реА"] },
  { word: "рдкреБрддреНрд░реА", male:["рдкреБрддреНрд░"], female:["рдкреБрддреНрд░реА"] }
];

/* ------------------- SETUP ------------------- */
let questions = [];
vachanQuestions.forEach(q => questions.push({type:'vachan',...q}));
lingQuestions.forEach(q => questions.push({type:'ling',...q}));
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}
shuffle(questions);

let current=0,score=0,lastSpoken="",recognition=null,voice=null;

/* ------------------- SPEECH ------------------- */
function chooseVoice(){
  const v=speechSynthesis.getVoices();
  const hi=v.filter(x=>/hi|hindi/i.test(x.lang||""));
  return hi.find(x=>/female|Aditi|Google/.test(x.name))||hi[0]||v[0];
}
function speak(txt){
  lastSpoken=txt;
  const u=new SpeechSynthesisUtterance(txt);
  u.lang="hi-IN";u.rate=0.95;if(voice)u.voice=voice;
  speechSynthesis.cancel();speechSynthesis.speak(u);
}
function normalize(s){return (s||"").normalize("NFD").replace(/[\u093C-\u094D\u0964-\u0965\s\p{P}]/gu,"").toLowerCase();}
function lev(a,b){if(a===b)return 0;let m=[],al=a.length,bl=b.length;
  for(let i=0;i<=al;i++){m[i]=[i];for(let j=1;j<=bl;j++)m[i][j]=i===0?j:0;}
  for(let i=1;i<=al;i++){for(let j=1;j<=bl;j++){m[i][j]=a[i-1]===b[j-1]?m[i-1][j-1]:Math.min(m[i-1][j]+1,m[i][j-1]+1,m[i-1][j-1]+1);}}return m[al][bl];}
function match(a,b){a=normalize(a);b=normalize(b);if(a===b)return true;return lev(a,b)<=Math.max(1,Math.floor(Math.max(a.length,b.length)*0.25));}

/* ------------------- ELEMENTS ------------------- */
const qText=document.getElementById("questionText");
const ans=document.getElementById("answerInput");
const submitBtn=document.getElementById("submitBtn");
const passBtn=document.getElementById("passBtn");
const replayBtn=document.getElementById("replayBtn");
const speakBtn=document.getElementById("speakBtn");
const playBtn=document.getElementById("playBtn");
const scoreDiv=document.getElementById("score");
const feedback=document.getElementById("feedbackText");
const status=document.getElementById("status");

/* ------------------- QUIZ LOGIC ------------------- */
function nextQ(){
  if(current>=questions.length)return endQuiz();
  const q=questions[current];
  let prompt,expected;
  if(q.type==="vachan"){prompt=`рд╡рдЪрди рдмрджрд▓рд┐рдП: ${q.word} рдХрд╛ рдмрд╣реБрд╡рдЪрди рдмрддрд╛рдЗрдП`;expected=q.answers;}
  else {
    if(["рд░рд╛рдиреА","рд▓рдбрд╝рдХреА","рдкрддреНрдиреА","рд╢реЗрд░рдиреА","рдкреБрддреНрд░реА"].includes(q.word)){
      prompt=`рд▓рд┐рдВрдЧ рдмрджрд▓рд┐рдП: ${q.word} рдХрд╛ рдкреБрд▓реНрд▓рд┐рдВрдЧ рдмрддрд╛рдЗрдП`;expected=q.male;
    } else {
      prompt=`рд▓рд┐рдВрдЧ рдмрджрд▓рд┐рдП: ${q.word} рдХрд╛ рд╕реНрддреНрд░реАрд▓рд┐рдВрдЧ рдмрддрд╛рдЗрдП`;expected=q.female;
    }
  }
  q._expected=expected;
  qText.textContent=prompt;ans.value="";feedback.textContent="";
  ans.disabled=false;submitBtn.disabled=false;passBtn.disabled=false;replayBtn.disabled=false;
  speak(prompt);
}
function correct(){score++;feedback.textContent="тЬЕ рд╕рд╣реА рдЙрддреНрддрд░!";feedback.style.color="#1a7f3a";speak("рд╕рд╣реА рдЙрддреНрддрд░");setTimeout(()=>{current++;nextQ();},2500);}
function wrong(){feedback.textContent="тЭМ рдЧрд▓рдд рдЙрддреНрддрд░! рдлрд┐рд░ рд╕реЗ рдмреЛрд▓реЗрдВ рдпрд╛ рдкрд╛рд╕ рджрдмрд╛рдПрдБред";feedback.style.color="#c00";speak("рдЧрд▓рдд рдЙрддреНрддрд░");}
submitBtn.onclick=()=>{const val=ans.value.trim();if(!val)return;const list=questions[current]._expected;
  if(list.some(x=>match(val,x)))correct();else wrong();};
passBtn.onclick=()=>{current++;nextQ();};
replayBtn.onclick=()=>{if(lastSpoken)speak(lastSpoken);};
playBtn.onclick=()=>{current=0;score=0;shuffle(questions);nextQ();};

/* ------------------- SPEECH RECOGNITION ------------------- */
try{
  const R=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(R){
    recognition=new R();recognition.lang="hi-IN";recognition.interimResults=false;recognition.maxAlternatives=1;
    recognition.onresult=e=>{const txt=e.results[0][0].transcript.trim();ans.value=txt;
      const list=questions[current]._expected;if(list.some(x=>match(txt,x)))correct();else wrong();};
    recognition.onerror=e=>{status.textContent="ЁЯОЩя╕П рддреНрд░реБрдЯрд┐: "+e.error;};
    speakBtn.onclick=()=>{status.textContent="ЁЯОЩя╕П рд╕реБрди рд░рд╣рд╛ рд╣реВрдБ";try{recognition.start();}catch{};};
  }
}catch(e){console.warn(e);}

/* ------------------- END QUIZ ------------------- */
function endQuiz(){
  document.getElementById("quizScreen").style.display="none";
  const r=document.getElementById("resultScreen");
  r.style.display="block";
  document.getElementById("finalScore").textContent=`рдЖрдкрдХрд╛ рд╕реНрдХреЛрд░: ${score} / ${questions.length}`;

  // Save to localStorage
  const data={name:localStorage.name,class:localStorage.className,score,total:questions.length,date:new Date().toLocaleDateString(),time:new Date().toLocaleTimeString()};
  localStorage[`result_${localStorage.name}`]=JSON.stringify(data);

  // Send to Google Sheet
  fetch("YOUR_SCRIPT_URL",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(data)
  });
}

/* ------------------- LOGIN ------------------- */
document.getElementById("loginBtn").onclick=()=>{
  const n=document.getElementById("studentName").value.trim();
  const c=document.getElementById("studentClass").value.trim();
  if(!n||!c)return alert("рдХреГрдкрдпрд╛ рдирд╛рдо рдФрд░ рдХрдХреНрд╖рд╛ рднрд░реЗрдВ!");
  if(localStorage[`result_${n}`]){document.getElementById("loginMsg").textContent="рдЖрдкрдиреЗ рдкрд╣рд▓реЗ рд╣реА рдХреНрд╡рд┐рдЬрд╝ рджреЗ рджрд┐рдпрд╛ рд╣реИред";return;}
  localStorage.name=n;localStorage.className=c;
  document.getElementById("loginScreen").style.display="none";
  document.getElementById("quizScreen").style.display="block";
  voice=chooseVoice();speak("рдХреНрд╡рд┐рдЬрд╝ рд╢реБрд░реВ рдХрд░реЗрдВ");
}

/* ------------------- WHATSAPP ------------------- */
document.getElementById("sendReportBtn").onclick=()=>{
  const phone="919994895676"; // e.g. 919876543210
  const msg=`рдЫрд╛рддреНрд░: ${localStorage.name}%0AрдХрдХреНрд╖рд╛: ${localStorage.className}%0Aрд╕реНрдХреЛрд░: ${score} / ${questions.length}%0Aрддрд╛рд░реАрдЦрд╝: ${new Date().toLocaleString()}`;
  const url=`https://wa.me/${phone}?text=${msg}`;
  window.open(url,"_blank");
}

window.onload=()=>{document.getElementById("loginScreen").style.display="block";}
</script>
</body>
</html>
