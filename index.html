<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>हिन्दी लिंग-वचन क्विज़</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #fff;
    padding: 20px;
}
#loginBox, #quizBox, #resultBox {
    max-width: 500px;
    margin: auto;
    display: none;
}
button {
    padding: 12px 20px;
    font-size: 18px;
    margin-top: 10px;
}
#timer {
    color: red;
    font-size: 20px;
    font-weight: bold;
}
</style>
</head>

<body>

<h2 style="text-align:center;">हिन्दी लिंग + वचन क्विज़</h2>

<!-- LOGIN -->
<div id="loginBox">
    <h3>कृपया अपना नाम लिखें</h3>
    <input id="studentName" type="text" placeholder="नाम लिखें" style="font-size:20px;padding:10px;width:100%;" />
    <button onclick="startLogin()">लॉगिन</button>
</div>

<!-- QUIZ -->
<div id="quizBox">
    <button onclick="startQuiz()">शुरू करें</button>
    <p id="question" style="font-size:26px;margin-top:20px;"></p>
    <p id="english"></p>
    <input id="answer" type="text" placeholder="उत्तर बोलें / लिखें" style="font-size:22px;padding:10px;width:100%;" />
    <button onclick="checkAnswer()">जांच</button>

    <p id="timer"></p>
</div>

<!-- RESULT -->
<div id="resultBox">
    <h2>क्विज़ समाप्त</h2>
    <p id="scoreText"></p>
    <button onclick="logoutAndSend()">लॉगआउट</button>
</div>

<script>
// ---------------- DATA ------------------

const questions = [
    { q:"लड़का", eng:"boy", type:"ling", ans:["पुल्लिंग"] },
    { q:"राजा", eng:"king", type:"ling", ans:["पुल्लिंग"] },

    { q:"लड़कियाँ", eng:"girls", type:"ling", ans:["स्त्रीलिंग"] },
    { q:"औरत", eng:"woman", type:"ling", ans:["स्त्रीलिंग"] },

    { q:"सेब", eng:"apple", type:"vachan", ans:["सेब"] },
    { q:"तस्वीर", eng:"picture", type:"vachan", ans:["तस्वीर"] },
    { q:"फल", eng:"fruit", type:"vachan", ans:["फल"] },
    { q:"आम", eng:"mango", type:"vachan", ans:["आम"] },
    { q:"फूल", eng:"flower", type:"vachan", ans:["फूल"] }
];

let shuffled = [];
let index = 0;
let score = 0;
let studentName = "";
let timeLeft = 10;
let timerInterval = null;

// Google Script URL
const SCRIPT_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLjCiIrW_GqD34UFh4qt0VcQC7Q4lTmQ9UFPSHNM1Iq37medCY1OzfZA95gJDcdthS_Ax2hEhlqG5ZAr3TSxrJVq6znDk8GuaeYGke5DFVR5QuIYsDtes_M9N3PzsVgyt6PujEKsYGAbYMZeLBr7btF2z5Ggv3Crjr-469VOrAdq3vtTAv7mb0utJwdrZK-ige6P_1MHPT5PjigP_ws0xWFl4XxeLeccbzPixQw3LixBYLyWvkeo1EOX5WkoRs9TM5DriRLZdohSUxSuKi3eOmgEAW1UpGFm2AjKiWrQ&lib=MJtJLyBLhYJ-I8iv1Kb4TmqdLM6UFQ5vk";

// ---------------- LOGIN ------------------

function startLogin() {
    studentName = document.getElementById("studentName").value.trim();
    if(studentName === "") { alert("नाम लिखें"); return; }

    localStorage.setItem("loggedName", studentName);

    document.getElementById("loginBox").style.display = "none";
    document.getElementById("quizBox").style.display = "block";
}

// ---------------- QUIZ ------------------

function startQuiz() {
    shuffled = questions.sort(() => Math.random() - 0.5);
    index = 0;
    score = 0;

    showQuestion();
}

function showQuestion() {
    if(index >= shuffled.length) {
        endQuiz();
        return;
    }

    let q = shuffled[index];

    document.getElementById("question").innerText = q.q;
    document.getElementById("english").innerText = "("+ q.eng +")";
    document.getElementById("answer").value = "";

    speak(q.q);

    startTimer();
}

// ---------------- TIMER ------------------

function startTimer() {
    clearInterval(timerInterval);
    timeLeft = 10;
    document.getElementById("timer").innerText = timeLeft + " sec";

    timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById("timer").innerText = timeLeft + " sec";

        if(timeLeft <= 0) {
            clearInterval(timerInterval);
            index++;
            showQuestion();
        }
    }, 1000);
}

// ---------------- CHECK ANSWER ------------------

function checkAnswer() {
    let user = document.getElementById("answer").value.trim();
    let correct = shuffled[index].ans;

    if(correct.includes(user)) {
        score++;
        speak("सही उत्तर");
    } else {
        speak("ग़लत उत्तर");
    }

    index++;
    showQuestion();
}

// ---------------- END QUIZ ------------------

function endQuiz() {
    clearInterval(timerInterval);
    document.getElementById("quizBox").style.display = "none";
    document.getElementById("resultBox").style.display = "block";

    document.getElementById("scoreText").innerText =
        studentName + " का स्कोर: " + score + "/" + questions.length;
}

// ---------------- LOGOUT + REPORT ------------------

function logoutAndSend() {
    let data = {
        name: studentName,
        score: score,
        attempted: questions.length,
        remarks: score < 5 ? "Needs practice" : "Good"
    };

    fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify(data)
    });

    localStorage.removeItem("loggedName");
    speak("Report sent");

    location.reload();
}

// ---------------- SPEAK ------------------

function speak(text) {
    let msg = new SpeechSynthesisUtterance(text);
    msg.lang = "hi-IN";
    speechSynthesis.speak(msg);
}

// ---------------- AUTO LOGIN ------------------

window.onload = function () {
    let saved = localStorage.getItem("loggedName");

    if(saved) {
        studentName = saved;
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("quizBox").style.display = "block";
    } else {
        document.getElementById("loginBox").style.display = "block";
    }
};

</script>

</body>
</html>
