<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>рд╣рд┐рдВрджреА рдСрдбрд┐рдпреЛ рдХреНрд╡рд┐рдЬрд╝ тАФ рд▓рд┐рдВрдЧ & рд╡рдЪрди (Simple)</title>
<style>
  body{font-family: 'Noto Sans Devanagari', system-ui, sans-serif; background:#ffffff; color:#111; margin:0; padding:20px; text-align:center;}
  h1{font-size:20px;color:#b71c1c;margin:6px 0 12px;}
  #questionText{font-size:18px;margin:18px 0;min-height:48px;}
  input#answerInput{padding:10px;font-size:16px;width:86%;max-width:420px;border:1px solid #ccc;border-radius:6px;text-align:center}
  .controls{margin:12px 0;display:flex;gap:8px;justify-content:center;flex-wrap:wrap;}
  button{padding:8px 12px;border-radius:6px;border:none;background:#1565c0;color:#fff;font-size:14px;cursor:pointer}
  button.secondary{background:#6c757d}
  #feedbackText{margin-top:12px;font-weight:700;height:26px}
  #score{margin-top:10px;color:#0b6623;font-weight:700}
  .small{font-size:12px;color:#666;margin-top:10px}
</style>
</head>
<body>
  <h1>рд╣рд┐рдВрджреА рдСрдбрд┐рдпреЛ рдХреНрд╡рд┐рдЬрд╝ тАФ рд▓рд┐рдВрдЧ & рд╡рдЪрди (Simple)</h1>

  <div id="questionText">рдХреНрд╡рд┐рдЬрд╝ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП "рд╢реБрд░реВ рдХрд░реЗрдВ" рджрдмрд╛рдПрдБ</div>

  <div>
    <input id="answerInput" placeholder="рдЙрддреНрддрд░ рдмреЛрд▓реЗрдВ рдпрд╛ рд▓рд┐рдЦреЗрдВ (Enter рд╕реЗ рдЬрд╛рдБрдЪреЗрдВ)" disabled />
  </div>

  <div class="controls">
    <button id="startBtn">тЦ╢я╕П рд╢реБрд░реВ рдХрд░реЗрдВ</button>
    <button id="resetBtn" class="secondary">ЁЯФД рд░реАрд╕реЗрдЯ</button>
    <button id="micBtn" disabled>ЁЯОд рдмреЛрд▓реЗрдВ</button>
    <button id="passBtn" class="secondary" disabled>тПн рдкрд╛рд╕</button>
    <button id="replayBtn" class="secondary" disabled>ЁЯФБ рдлрд┐рд░ рд╕реБрдиреЗрдВ</button>
    <button id="checkBtn">тЬЕ рдЬрд╛рдБрдЪреЗрдВ</button>
  </div>

  <div id="feedbackText"></div>
  <div id="score"></div>
  <div class="small">Chrome (HTTPS/localhost) рдкрд░ рдорд╛рдЗрдХреНрд░реЛрдлрд╝реЛрди рдмреЗрд╣рддрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред</div>

<script>
/* -----------------------
   Questions (final set)
   15 рд╡рдЪрди (clean) + 15 рд▓рд┐рдВрдЧ (pairs)
   ----------------------- */
const vachanQuestions = [
  { word: "рдХрд┐рддрд╛рдм", answers:["рдХрд┐рддрд╛рдмреЗрдВ","рдХрд┐рддрд╛рдмреЗ"] },
  { word: "рд▓рдбрд╝рдХрд╛", answers:["рд▓рдбрд╝рдХреЗ","рд▓рдбрд╝рдХреЗрдВ"] },
  { word: "рд▓рдбрд╝рдХреА", answers:["рд▓рдбрд╝рдХрд┐рдпрд╛рдБ","рд▓рдбрд╝рдХрд┐рдпрд╛рдВ","рд▓рдбрд╝рдХрд┐рдпреЙрдВ"] },
  { word: "рд░рд╛рдЬрд╛", answers:["рд░рд╛рдЬреЗ","рд░рд╛рдЬрд╛рдУрдВ","рд░рд╛рдЬреЗред"] },
  { word: "рдмрд╛рд▓рдХ", answers:["рдмрд╛рд▓рдХ","рдмрд╛рд▓рдХ"] },
  { word: "рдлреВрд▓", answers:["рдлреВрд▓","рдлреВрд▓реЛрдВ"] },
  { word: "рдмрдЪреНрдЪрд╛", answers:["рдмрдЪреНрдЪреЗ","рдмрдЪреНрдЪреЛрдВ"] },
  { word: "рдкреБрд╕реНрддрдХ", answers:["рдкреБрд╕реНрддрдХреЗрдВ","рдкреБрд╕реНрддрдХреЛрдВ"] },
  { word: "рдкрдХреНрд╖реА", answers:["рдкрдХреНрд╖реА","рдкрдХреНрд╖рд┐рдпреЛрдВ"] },
  { word: "рдкреЗрдбрд╝", answers:["рдкреЗрдбрд╝","рдкреЗрдбрд╝реЛрдВ"] },
  { word: "рд╕реИрдирд┐рдХ", answers:["рд╕реИрдирд┐рдХ","рд╕реИрдирд┐рдХреЛрдВ"] },
  { word: "рдлрд▓", answers:["рдлрд▓","рдлрд▓"] },
  { word: "рдХрдорд▓", answers:["рдХрдорд▓","рдХрдорд▓реЛрдВ"] },
  { word: "рдЦрд┐рд▓рд╛рдбрд╝реА", answers:["рдЦрд┐рд▓рд╛рдбрд╝реА","рдЦрд┐рд▓рд╛рдбрд╝рд┐рдпреЛрдВ"] },
  { word: "рдЖрдо", answers:["рдЖрдо","рдЖрдо"] }
];

const lingPairs = [
  ["рд░рд╛рдЬрд╛","рд░рд╛рдиреА"],
  ["рд╢реЗрд░","рд╢реЗрд░рдиреА"],
  ["рдкрддрд┐","рдкрддреНрдиреА"],
  ["рдирд╛рдирд╛","рдирд╛рдиреА"],
  ["рдореБрд░реНрдЧрд╛","рдореБрд░реНрдЧреА"],
  ["рдкреБрддреНрд░","рдкреБрддреНрд░реА"],
  ["рдЕрдзреНрдпрд╛рдкрдХ","рдЕрдзреНрдпрд╛рдкрд┐рдХрд╛"],
  ["рд╕реЗрда","рд╕реЗрдард╛рдиреА"]
];

/* Build ling list - one direction per pair chosen randomly, so no duplicates */
function buildLingQuestions(){
  const out = [];
  lingPairs.forEach(([m,f])=>{
    if(Math.random() < 0.5) out.push({ type:'ling', word:m, ask:'рд╕реНрддреНрд░реАрд▓рд┐рдВрдЧ', answers:[f] });
    else out.push({ type:'ling', word:f, ask:'рдкреБрд▓реНрд▓рд┐рдВрдЧ', answers:[m] });
  });
  return out;
}

/* Build combined question pool */
function buildPool(){
  const pool = [];
  vachanQuestions.forEach(q => pool.push({ type:'vachan', word:q.word, answers:q.answers }));
  const lingQs = buildLingQuestions();
  lingQs.forEach(q=>pool.push(q));
  return pool;
}

/* shuffle once on start/reset */
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }

/* -----------------------
   Voice & matching helpers
   ----------------------- */
let selectedVoice = null;
function pickFemaleHindiVoice(){
  const voices = speechSynthesis.getVoices();
  if(!voices || voices.length===0) return null;
  const hi = voices.filter(v => (v.lang||'').toLowerCase().startsWith('hi'));
  if(hi.length===0) return voices[0];
  // prefer voices with female-like names if present
  const preferNames = ['female','aditi','shruti','google','samantha','ananya','aarya'];
  let pick = hi.find(v => preferNames.some(p => (v.name||'').toLowerCase().includes(p)));
  if(!pick) pick = hi[0];
  return pick;
}
function speak(text, onend){
  try{
    speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'hi-IN';
    u.rate = 0.95;
    if(!selectedVoice) selectedVoice = pickFemaleHindiVoice();
    if(selectedVoice) u.voice = selectedVoice;
    if(onend) u.onend = onend;
    speechSynthesis.speak(u);
  }catch(e){ console.warn(e); }
}

/* normalize for Hindi: unify common matra differences, remove punctuation & spaces */
function normalizeHindi(s){
  if(!s) return '';
  s = s.toString().normalize('NFD');
  s = s.replace(/[рдБрдВ]/g,'рдВ');            // unify nasals
  s = s.replace(/[реЙреЛреМ]/g,'реЛ');           // map o-variants to рдУ-like
  s = s.replace(/[реИреЗ]/g,'реЗ');            // map рдП-variants
  s = s.replace(/[реГ]/g,'рд░');             // rare map
  s = s.replace(/[рд╛]/g,'рд╛');            // keep
  s = s.replace(/[реАрд┐]/g,'рд┐');           // map i variants
  s = s.replace(/[реВреБ]/g,'реБ');           // map u variants
  s = s.replace(/[^\u0900-\u097F]/g,''); // remove non-Devanagari
  s = s.replace(/реН+/g,'');              // drop virama (makes matching tolerant)
  return s;
}

/* LCS length for ordered similarity */
function lcsLen(a,b){
  const n=a.length, m=b.length;
  if(n===0||m===0) return 0;
  const dp = Array.from({length:n+1}, ()=> Array(m+1).fill(0));
  for(let i=1;i<=n;i++){
    for(let j=1;j<=m;j++){
      if(a[i-1]===b[j-1]) dp[i][j]=dp[i-1][j-1]+1;
      else dp[i][j]=Math.max(dp[i-1][j], dp[i][j-1]);
    }
  }
  return dp[n][m];
}

/* Main match rule:
   - If expectedNormalized === 'рд╕реЗрдм' then accept only exact normalized 'рд╕реЗрдм'
   - For other expected forms: accept if exact equality OR LCS similarity >= 0.7 AND userLength >= expectedLength-1
*/
function isGoodMatch(userRaw, expectedRaw){
  const u = normalizeHindi(userRaw);
  const e = normalizeHindi(expectedRaw);
  if(!u || !e) return false;
  // special strict case for 'рд╕реЗрдм' single-word plural question
  if(e === 'рд╕реЗрдм') return u === 'рд╕реЗрдм';
  if(u === e) return true;
  const lcs = lcsLen(u,e);
  const sim = lcs / Math.max(u.length, e.length);
  if(sim >= 0.7 && u.length >= Math.max(1, e.length - 1)) return true;
  return false;
}

function matchAnswer(userRaw, expectedList){
  for(const ex of expectedList){
    if(isGoodMatch(userRaw, ex)) return true;
  }
  return false;
}

/* -----------------------
   UI and quiz flow
   ----------------------- */
const questionText = document.getElementById('questionText');
const answerInput = document.getElementById('answerInput');
const startBtn = document.getElementById('startBtn');
const resetBtn = document.getElementById('resetBtn');
const micBtn = document.getElementById('micBtn');
const passBtn = document.getElementById('passBtn');
const replayBtn = document.getElementById('replayBtn');
const checkBtn = document.getElementById('checkBtn');
const feedbackText = document.getElementById('feedbackText');
const scoreDiv = document.getElementById('score');
const statusDiv = document.getElementById('status');

let pool = [], index = 0, score = 0;
let recognition = null, listening = false;

/* prepare and shuffle pool */
function preparePool(){
  pool = buildPool();
  shuffle(pool);
  index = 0; score = 0;
}

/* show question */
function showQuestion(){
  if(index >= pool.length){ finishQuiz(); return; }
  const q = pool[index];
  let prompt = '';
  if(q.type === 'vachan') prompt = `рд╡рдЪрди рдмрджрд▓рд┐рдП: ${q.word} рдХрд╛ рдмрд╣реБрд╡рдЪрди рдмрддрд╛рдЗрдП`;
  else prompt = `рд▓рд┐рдВрдЧ рдмрджрд▓рд┐рдП: ${q.word} рдХрд╛ ${q.ask} рдмрддрд╛рдЗрдП`;
  questionText.textContent = prompt;
  answerInput.value = '';
  feedbackText.textContent = '';
  speak(prompt);
}

/* start */
startBtn.onclick = ()=>{
  preparePool();
  selectedVoice = pickFemaleHindiVoice();
  answerInput.disabled = false;
  micBtn.disabled = false;
  passBtn.disabled = false;
  replayBtn.disabled = false;
  checkBtn.disabled = false;
  startBtn.disabled = true;
  resetBtn.disabled = false;
  scoreDiv.textContent = '';
  speak("рдЪрд▓реЛ, рд╣рдо рд╣рд┐рдВрджреА рдкреНрд░рд╢реНрдиреЛрддреНрддрд░реА рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред", ()=> setTimeout(showQuestion, 700));
};

/* reset */
resetBtn.onclick = ()=>{
  if(recognition && listening){ try{ recognition.stop(); }catch(e){} listening=false; micBtn.textContent="ЁЯОд рдмреЛрд▓реЗрдВ"; }
  preparePool();
  answerInput.value=''; feedbackText.textContent=''; scoreDiv.textContent='';
  answerInput.disabled = true; micBtn.disabled = true; passBtn.disabled = true; replayBtn.disabled = true;
  checkBtn.disabled = false; startBtn.disabled = false;
  questionText.textContent = 'рдХреНрд╡рд┐рдЬрд╝ рд░реАрд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ тАФ "рд╢реБрд░реВ рдХрд░реЗрдВ" рджрдмрд╛рдПрдБ';
  speak("рдХреНрд╡рд┐рдЬрд╝ рд░реАрд╕реЗрдЯ рд╣реЛ рдЧрдпрд╛ред рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП 'рд╢реБрд░реВ рдХрд░реЗрдВ' рджрдмрд╛рдПрдБред");
};

/* check typed/filled answer */
function checkTyped(){
  const user = answerInput.value.trim();
  if(!user){ feedbackText.textContent = 'рдХреГрдкрдпрд╛ рдЙрддреНрддрд░ рдЯрд╛рдЗрдк рдХрд░реЗрдВ рдпрд╛ рдмреЛрд▓реЗрдВред'; return; }
  const expected = pool[index].answers;
  if(matchAnswer(user, expected)){
    feedbackText.style.color = '#1a7f3a';
    feedbackText.textContent = 'тЬЕ рдмрд╣реБрдд рдмрдврд╝рд┐рдпрд╛, рд╕рд╣реА рдЬрд╡рд╛рдм!';
    speak('рдмрд╣реБрдд рдмрдврд╝рд┐рдпрд╛, рд╕рд╣реА рдЬрд╡рд╛рдм!', ()=> {
      score++; index++;
      setTimeout(showQuestion, 2500);
    });
  } else {
    feedbackText.style.color = '#c00';
    feedbackText.textContent = 'тЭМ рдлрд┐рд░ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ!';
    speak('рдлрд┐рд░ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ!');
  }
}

/* pass */
passBtn.onclick = ()=>{
  speak('рдЕрдЧрд▓рд╛ рдкреНрд░рд╢реНрди рд╕реБрдирд┐рдПред', ()=> {
    feedbackText.style.color='#555'; feedbackText.textContent='тПн рдкреНрд░рд╢реНрди рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЧрдпрд╛ред';
    index++; setTimeout(showQuestion, 700);
  });
};

/* replay */
replayBtn.onclick = ()=> {
  if(questionText.textContent) speak(questionText.textContent);
};

/* check button handler */
checkBtn.onclick = checkTyped;

/* Enter key on input */
answerInput.addEventListener('keydown', (ev)=>{ if(ev.key === 'Enter') checkTyped(); });

/* finish */
function finishQuiz(){
  questionText.textContent = 'рдХреНрд╡рд┐рдЬрд╝ рд╕рдорд╛рдкреНрдд!';
  feedbackText.textContent = '';
  scoreDiv.textContent = `рдЖрдкрдХрд╛ рд╕реНрдХреЛрд░: ${score} / ${pool.length}`;
  speak(`рдХреНрд╡рд┐рдЬрд╝ рд╕рдорд╛рдкреНрддред рдЖрдкрдХрд╛ рд╕реНрдХреЛрд░ ${score} рдореЗрдВ рд╕реЗ ${pool.length} рд╣реИред`);
  answerInput.disabled = true; micBtn.disabled = true; passBtn.disabled = true; replayBtn.disabled = true; checkBtn.disabled = true;
  startBtn.disabled = false;
}

/* -----------------------
   Speech recognition (voice input)
   ----------------------- */
try{
  const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(Rec){
    recognition = new Rec();
    recognition.lang = 'hi-IN';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
    recognition.onresult = (e)=>{
      listening = false; micBtn.textContent = 'ЁЯОд рдмреЛрд▓реЗрдВ';
      const said = e.results[0][0].transcript.trim();
      answerInput.value = said;
      // auto-evaluate
      const expected = pool[index].answers;
      if(matchAnswer(said, expected)){
        feedbackText.style.color = '#1a7f3a';
        feedbackText.textContent = 'тЬЕ рдмрд╣реБрдд рдмрдврд╝рд┐рдпрд╛, рд╕рд╣реА рдЬрд╡рд╛рдм!';
        speak('рдмрд╣реБрдд рдмрдврд╝рд┐рдпрд╛, рд╕рд╣реА рдЬрд╡рд╛рдм!', ()=>{ score++; index++; setTimeout(showQuestion, 2500); });
      } else {
        feedbackText.style.color = '#c00';
        feedbackText.textContent = 'тЭМ рдлрд┐рд░ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ!';
        speak('рдлрд┐рд░ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ!');
      }
    };
    recognition.onerror = (ev)=>{ statusDiv.textContent = 'ЁЯОЩя╕П рддреНрд░реБрдЯрд┐: ' + (ev.error||'error'); listening=false; micBtn.textContent='ЁЯОд рдмреЛрд▓реЗрдВ'; };
    recognition.onend = ()=>{ listening=false; micBtn.textContent='ЁЯОд рдмреЛрд▓реЗрдВ'; };
    micBtn.onclick = ()=>{
      if(!pool.length){ feedbackText.textContent = 'рдХреГрдкрдпрд╛ рдкрд╣рд▓реЗ "рд╢реБрд░реВ рдХрд░реЗрдВ" рджрдмрд╛рдПрдБред'; return; }
      if(listening){ try{ recognition.stop(); }catch(e){} listening = false; micBtn.textContent='ЁЯОд рдмреЛрд▓реЗрдВ'; }
      else { recognition.start(); listening = true; micBtn.textContent='тП╣ рд░реЛрдХреЗрдВ'; statusDiv.textContent=''; }
    };
  } else {
    micBtn.disabled = true;
    micBtn.textContent = 'рдорд╛рдЗрдХ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ';
  }
}catch(e){ console.warn(e); micBtn.disabled=true; micBtn.textContent='рдорд╛рдЗрдХ рди рдЙрдкрд▓рдмреНрдз'; }

/* initialize: set reset state */
resetBtn.click();

</script>
</body>
</html>
