
<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>рд╣рд┐рдВрджреА рдСрдбрд┐рдпреЛ рдХреНрд╡рд┐рдЬрд╝ тАФ рд▓рд┐рдВрдЧ & рд╡рдЪрди (30 рдкреНрд░рд╢реНрди)</title>
<style>
  body{font-family: 'Noto Sans Devanagari', sans-serif; background:#f7fbff; margin:0; padding:28px; display:flex; justify-content:center;}
  .box{width:820px; max-width:98%; background:#fff; padding:24px; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.08);}
  h1{margin:0 0 10px 0; font-size:22px; color:#1b2b4a; text-align:center;}
  #startScreen{ text-align:center; padding:20px; }
  #questionArea{ display:none; }
  #questionText{font-size:20px; margin:18px 0; text-align:center; color:#111;}
  .controls{display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin:12px 0;}
  input[type="text"]{width:68%; padding:10px 12px; font-size:16px; border-radius:8px; border:1px solid #cfd8e3;}
  button{padding:10px 16px; font-size:15px; border:none; border-radius:8px; cursor:pointer; background:#007bff; color:#fff;}
  button.secondary{background:#6c757d;}
  #status{margin-top:10px; text-align:center; color:#b00020; font-weight:700;}
  #feedbackText{margin-top:8px; text-align:center; font-size:18px; font-weight:700;}
  #score{margin-top:14px; text-align:center; font-weight:700; color:#1a7f3a;}
  .small{font-size:13px; color:#555; text-align:center; margin-top:6px;}
  .meta { font-size:14px; color:#333; text-align:center; margin-top:8px; }
</style>
</head>
<body>
  <div class="box">
    <h1>ЁЯОз рд╣рд┐рдВрджреА рдСрдбрд┐рдпреЛ рдХреНрд╡рд┐рдЬрд╝ тАФ рд▓рд┐рдВрдЧ & рд╡рдЪрди (30 рдкреНрд░рд╢реНрди)</h1>

    <div id="startScreen">
      <p style="font-size:16px;">рдХреНрд╡рд┐рдЬрд╝ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ тАЬрд╢реБрд░реВ рдХрд░реЗрдВтАЭ рджрдмрд╛рдПрдБред</p>
      <button id="startBtn">ЁЯФШ рд╢реБрд░реБ рдХрд░реЗрдВ</button>
      <div class="meta">рдХреБрд▓ рдкреНрд░рд╢реНрди: 30 ┬╖ рдорд┐рд╢реНрд░рд┐рдд рд▓рд┐рдВрдЧ рдФрд░ рд╡рдЪрди ┬╖ Chrome рдореЗрдВ mic рдЕрдиреБрдорддрд┐ рджреЗрдВ</div>
    </div>

    <div id="questionArea">
      <div id="questionText">Play рджрдмрд╛рдПрдБ тАФ рдкреНрд░рд╢реНрди рд╕реНрд╡рддрдГ рдкрдврд╝реЗ рдЬрд╛рдПрдБрдЧреЗред</div>

      <div style="display:flex;justify-content:center;gap:10px;align-items:center;flex-wrap:wrap;">
        <input id="answerInput" type="text" placeholder="рдпрд╣рд╛рдБ рдЖрд╡рд╛рдЬрд╝ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдЙрддреНрддрд░ рджрд┐рдЦреЗрдЧрд╛ тАФ рдпрд╛ рдЯрд╛рдЗрдк рдХрд░реЗрдВ" disabled />
      </div>

      <div class="controls">
        <button id="playBtn">ЁЯФК Play</button>
        <button id="speakBtn" disabled>ЁЯОд Speak</button>
        <button id="submitBtn" disabled>Submit</button>
        <button id="passBtn" class="secondary" disabled>Pass</button>
        <button id="replayBtn" class="secondary" disabled>ЁЯФБ Replay TTS</button>
      </div>

      <div id="status"></div>
      <div id="feedbackText"></div>
      <div id="score"></div>
      <div class="small">рдпрджрд┐ рд╡реЙрдЗрд╕ рдирд╣реАрдВ рдЪрд▓реЗ рддреЛ рдиреАрдЪреЗ рдЯрд╛рдЗрдк рдХрд░рдХреЗ Submit рдХрд░реЗрдВред</div>
    </div>
  </div>

<script>
/* =========================
   QUESTIONS тАФ 30 total
   15 vachan (singularтЖТplural)
   15 ling (gender) тАФ mapping provided
   ========================= */

/* Vachan (рдПрдХрд╡рдЪрди тЖТ рдмрд╣реБрд╡рдЪрди) - 15 items (removed 'рдорд╛рддрд╛','рд▓рддрд╛', added 'рддрд╕реНрд╡реАрд░', 'рд╕реЗрдм') */
const vachanQuestions = [
  { word: "рдкрд╛рдард╢рд╛рд▓рд╛", answers:["рдкрд╛рдард╢рд╛рд▓рд╛рдПрдБ","рдкрд╛рдард╢рд╛рд▓рд╛рдПрдВ","рдкрд╛рдард╢рд╛рд▓рд╛рдпреЗрдВ"] },
  { word: "рдорд╛рд▓рд╛", answers:["рдорд╛рд▓рд╛рдПрдБ","рдорд╛рд▓рд╛рдПрдВ","рдорд╛рд▓рд╛рдпреЗрдВ"] },
  { word: "рдЪрд┐рдбрд╝рд┐рдпрд╛", answers:["рдЪрд┐рдбрд╝рд┐рдпрд╛рдПрдБ","рдЪрд┐рдбрд╝рд┐рдпрд╛рдПрдВ","рдЪрд┐рдбрд╝рд┐рдпрд╛рдпреЗрдВ"] },
  { word: "рдЧреБрдбрд╝рд┐рдпрд╛", answers:["рдЧреБрдбрд╝рд┐рдпрд╛рдБ","рдЧреБрдбрд╝рд┐рдпрд╛рдВ","рдЧреБрдбрд╝рд┐рдпрд╛рдБ"] },
  { word: "рд▓рдбрд╝рдХреА", answers:["рд▓рдбрд╝рдХрд┐рдпрд╛рдБ","рд▓рдбрд╝рдХрд┐рдпрд╛рдВ","рд▓рдбрд╝рдХрд┐рдпрд╛рдБ"] },
  { word: "рдирджреА", answers:["рдирджрд┐рдпрд╛рдБ","рдирджрд┐рдпрд╛рдВ","рдирджрд┐рдпрд╛рдБ"] },
  { word: "рд░реЛрдЯреА", answers:["рд░реЛрдЯрд┐рдпрд╛рдБ","рд░реЛрдЯрд┐рдпрд╛рдВ","рд░реЛрдЯрд┐рдпрд╛рдБ"] },
  { word: "рдЧрд╛рдбрд╝реА", answers:["рдЧрд╛рдбрд╝рд┐рдпрд╛рдБ","рдЧрд╛рдбрд╝рд┐рдпреЛрдВ","рдЧрд╛рдбрд╝рд┐рдпреЛрдВ"] },
  { word: "рдХреБрд░реНрд╕реА", answers:["рдХреБрд░реНрд╕рд┐рдпрд╛рдБ","рдХреБрд░реНрд╕рд┐рдпрд╛рдВ","рдХреБрд░реНрд╕рд┐рдпрд╛рдБ"] },
  { word: "рдХрд┐рддрд╛рдм", answers:["рдХрд┐рддрд╛рдмреЗрдВ","рдХрд┐рддрд╛рдмреЛрдВ","рдХрд┐рддрд╛рдмреЗрдВ"] },
  { word: "рд▓рдбрд╝рдХрд╛", answers:["рд▓рдбрд╝рдХреЗ","рд▓рдбрд╝рдХреЛрдВ","рд▓рдбрд╝рдХреЗ"] },
  { word: "рд░реБрдкрдпрд╛", answers:["рд░реБрдкрдпреЗ","рд░реБрдкрдпреЛрдВ","рд░реБрдкрдП"] },
  { word: "рдХрдорд░рд╛", answers:["рдХрдорд░реЗ","рдХрдорд░реЛрдВ","рдХрдорд░реЗ"] },
  { word: "рддрд╕реНрд╡реАрд░", answers:["рддрд╕реНрд╡реАрд░реЗрдВ","рддрд╕реНрд╡реАрд░реЛрдВ","рддрд╕реНрд╡реАрд░реЗрдВ"] },
  { word: "рд╕реЗрдм", answers:["рд╕реЗрдм","рд╕реЗрдмреЛрдВ"] } // 'рд╕реЗрдм' same often; accept both forms
];

/* Ling (gender) тАФ 15 items with mapping (we will ask randomly pul/stri) */
const lingQuestions = [
  { word: "рдкрд┐рддрд╛", male:["рдкрд┐рддрд╛","рдкрд┐рддрд╛рдЬреА"], female:["рдорд╛рддрд╛","рдорд╛рдБ","рдорд╛рдВ","рдорд╛рддрд╛ рдЬреА"] },
  { word: "рдкреБрддреНрд░", male:["рдкреБрддреНрд░"], female:["рдкреБрддреНрд░реА"] },
  { word: "рдШреЛрдбрд╝рд╛", male:["рдШреЛрдбрд╝рд╛","рдШреЛрдбрд╝реЗ"], female:["рдШреЛрдбрд╝реА"] },
  { word: "рд╢реЗрд░", male:["рд╢реЗрд░"], female:["рд╢реЗрд░рдиреА"] },
  { word: "рдирд░", male:["рдирд░"], female:["рдирд╛рд░реА","рдорд╛рджрд╛","рд╕реНрддреНрд░реА"] },
  { word: "рд╢рд┐рд╖реНрдп", male:["рд╢рд┐рд╖реНрдп"], female:["рд╢рд┐рд╖реНрдпрд╛"] },
  { word: "рдирд╛рдирд╛", male:["рдирд╛рдирд╛"], female:["рдирд╛рдиреА"] },
  { word: "рд╕реЗрда", male:["рд╕реЗрда"], female:["рд╕реЗрдард╛рдиреА","рд╕реЗрдардиреА"] },
  { word: "рдкрддрд┐", male:["рдкрддрд┐"], female:["рдкрддреНрдиреА"] },
  { word: "рдореБрд░рдЧрд╛", male:["рдореБрд░рдЧрд╛"], female:["рдореБрд░рдЧреА","рдореБрд░реНрдЧреА"] },
  { word: "рд░рд╛рдЬрд╛", male:["рд░рд╛рдЬрд╛"], female:["рд░рд╛рдиреА"] },
  { word: "рдЖрджрдореА", male:["рдЖрджрдореА"], female:["рдФрд░рдд","рдорд╣рд┐рд▓рд╛","рд╕реНрддреНрд░реА"] },
  { word: "рдЕрднрд┐рдиреЗрддрд╛", male:["рдЕрднрд┐рдиреЗрддрд╛"], female:["рдЕрднрд┐рдиреЗрддреНрд░реА"] },
  { word: "рднрд╛рдИ", male:["рднрд╛рдИ"], female:["рдмрд╣рди"] },
  { word: "рдЕрдзреНрдпрд╛рдкрдХ", male:["рдЕрдзреНрдпрд╛рдкрдХ"], female:["рдЕрдзреНрдпрд╛рдкрд┐рдХрд╛","рдЕрдзреНрдпрд╛рдкрд┐рдХрд╛"] }
];

/* Build unified questions array with type flags:
   For vachan: {type:'vachan', word, answers}
   For ling: {type:'ling', word, maleAnswers, femaleAnswers}
*/
let questions = [];
vachanQuestions.forEach(q => questions.push({ type:'vachan', word:q.word, answers:q.answers }));
lingQuestions.forEach(q => questions.push({ type:'ling', word:q.word, maleAnswers:q.male, femaleAnswers:q.female }));

/* Shuffle function */
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } }
shuffle(questions);

/* UI elements */
const startScreen = document.getElementById('startScreen');
const questionArea = document.getElementById('questionArea');
const startBtn = document.getElementById('startBtn');
const qText = document.getElementById('questionText');
const answerInput = document.getElementById('answerInput');
const playBtn = document.getElementById('playBtn');
const speakBtn = document.getElementById('speakBtn');
const submitBtn = document.getElementById('submitBtn');
const passBtn = document.getElementById('passBtn');
const replayBtn = document.getElementById('replayBtn');
const statusDiv = document.getElementById('status');
const feedbackText = document.getElementById('feedbackText');
const scoreDiv = document.getElementById('score');

let current = 0, score = 0, lastSpoken = "", selectedVoice = null;

/* Choose a female-ish Hindi voice if available */
function chooseFemaleVoice(){
  const voices = speechSynthesis.getVoices();
  if(!voices || voices.length===0) return null;
  const preferred = voices.filter(v=>/hi|hindi/i.test(v.lang || v.name));
  const femaleHints = ["female","zira","samantha","aditi","shruti","ananya","maya","leena","koyal","aarti","reema","sneha","google"];
  let candidate = preferred.find(v=> femaleHints.some(h=> (v.name||"").toLowerCase().includes(h.toLowerCase())) );
  if(!candidate) candidate = preferred[0] || voices.find(v=> femaleHints.some(h=> (v.name||"").toLowerCase().includes(h.toLowerCase())) ) || voices[0];
  return candidate || null;
}

/* TTS speak with selected voice */
function speakHindi(text){
  lastSpoken = text;
  try{
    speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "hi-IN";
    if(selectedVoice) u.voice = selectedVoice;
    u.rate = 0.95;
    u.pitch = 1.0;
    speechSynthesis.speak(u);
  }catch(e){ console.warn(e); }
}

/* Normalization + fuzzy match (Devanagari tolerant) */
function normalizeDeva(s){
  if(!s) return "";
  s = s.normalize('NFD');
  // remove matras/virama/nukta combining marks and punctuation/spaces
  s = s.replace(/[\u093C-\u094D\u0951-\u0954\u0962-\u0963\-\.\,\/\s\u0964\u0965'":;!?]/g,'');
  return s.toLowerCase();
}
function levenshtein(a,b){
  if(a===b) return 0;
  a=a||''; b=b||'';
  const al=a.length, bl=b.length;
  if(al===0) return bl; if(bl===0) return al;
  let v0=new Array(bl+1), v1=new Array(bl+1);
  for(let j=0;j<=bl;j++) v0[j]=j;
  for(let i=0;i<al;i++){
    v1[0]=i+1;
    for(let j=0;j<bl;j++){
      const cost = a[i]===b[j]?0:1;
      v1[j+1] = Math.min(v1[j]+1, v0[j+1]+1, v0[j]+cost);
    }
    for(let j=0;j<=bl;j++) v0[j]=v1[j];
  }
  return v1[bl];
}
function isMatch(recognized, correct){
  const r = normalizeDeva(recognized);
  const c = normalizeDeva(correct);
  if(!r || !c) return false;
  if(r === c) return true;
  const maxLen = Math.max(r.length, c.length);
  const threshold = Math.max(1, Math.floor(maxLen * 0.22)); // allow ~22% edits
  const dist = levenshtein(r, c);
  return dist <= threshold;
}
function checkAgainstList(recognized, list){
  for(const ans of list){
    if(isMatch(recognized, ans)) return true;
  }
  return false;
}

/* Build question prompt dynamically:
   - For vachan: "рд╡рдЪрди рдмрджрд▓рд┐рдП тАФ <word> рдХрд╛ рдмрд╣реБрд╡рдЪрди рдмрддрд╛рдЗрдП"
   - For ling: randomly ask "рдкреБрд▓реНрд▓рд┐рдВрдЧ рдмрддрд╛рдЗрдП" or "рд╕реНрддреНрд░реАрд▓рд┐рдВрдЧ рдмрддрд╛рдЗрдП" and set expected answers accordingly
*/
function makePrompt(qObj){
  if(qObj.type === 'vachan'){
    return { prompt: `рд╡рдЪрди рдмрджрд▓рд┐рдП рдкреНрд░рд╢реНрди: ${qObj.word} рдХрд╛ рдмрд╣реБрд╡рдЪрди рдмрддрд╛рдЗрдП`, expected: qObj.answers };
  } else {
    // randomize asking either pul or stri
    const askFemale = Math.random() < 0.5; // 50% chance
    if(askFemale){
      return { prompt: `рд▓рд┐рдВрдЧ рдмрджрд▓рд┐рдП рдкреНрд░рд╢реНрди: ${qObj.word} рдХрд╛ рд╕реНрддреНрд░реАрд▓рд┐рдВрдЧ рд░реВрдк рдмрддрд╛рдЗрдП`, expected: qObj.femaleAnswers };
    } else {
      return { prompt: `рд▓рд┐рдВрдЧ рдмрджрд▓рд┐рдП рдкреНрд░рд╢реНрди: ${qObj.word} рдХрд╛ рдкреБрд▓реНрд▓рд┐рдВрдЧ рд░реВрдк рдмрддрд╛рдЗрдП`, expected: qObj.maleAnswers };
    }
  }
}

/* Show a question */
function showQuestion(){
  if(current >= questions.length){ finishQuiz(); return; }
  const qObj = questions[current];
  const item = makePrompt(qObj);
  // store expected answers on qObj for checking
  qObj._expected = item.expected;
  qText.textContent = item.prompt;
  answerInput.value = "";
  answerInput.disabled = false;
  submitBtn.disabled = false;
  passBtn.disabled = false;
  replayBtn.disabled = false;
  speakBtn.disabled = recognitionAvailable ? false : true;
  statusDiv.textContent = "";
  feedbackText.textContent = "";
  // speak question after a short pause
  setTimeout(()=>{ speakHindi(item.prompt); }, 250);
}

/* Feedback display */
function showFeedback(msg, ok){
  feedbackText.textContent = msg;
  feedbackText.style.color = ok ? "#1a7f3a" : "#b00020";
}

/* Correct / Wrong handlers */
function correctAnswer(){
  score++;
  showFeedback("тЬЕ рд╕рд╣реА рдЙрддреНрддрд░!", true);
  speakHindi("рд╕рд╣реА рдЙрддреНрддрд░");
  // move to next after short delay
  setTimeout(()=>{ current++; showQuestion(); }, 800);
}
function wrongAnswer(){
  showFeedback("тЭМ рдЧрд▓рдд рдЙрддреНрддрд░ тАФ рдлрд┐рд░ рд╕реЗ рдмреЛрд▓реЗрдВ рдпрд╛ 'Pass' рджрдмрд╛рдПрдБред", false);
  speakHindi("рдЧрд▓рдд рдЙрддреНрддрд░");
}

/* Submit typed */
submitBtn.addEventListener('click', ()=>{
  const val = (answerInput.value || "").trim();
  if(!val){ statusDiv.style.color="#b00020"; statusDiv.textContent = "рдХреГрдкрдпрд╛ рдЙрддреНрддрд░ рджреЗрдВ"; return; }
  const expected = questions[current]._expected || [];
  if(checkAgainstList(val, expected)) correctAnswer();
  else wrongAnswer();
});

/* Pass */
passBtn.addEventListener('click', ()=>{
  current++;
  statusDiv.textContent = "";
  if(current < questions.length) showQuestion(); else finishQuiz();
});

/* Replay TTS */
replayBtn.addEventListener('click', ()=>{ if(lastSpoken) speakHindi(lastSpoken); });

/* Play / Start button */
playBtn.addEventListener('click', ()=>{
  playBtn.textContent = "ЁЯФБ Restart";
  current = 0; score = 0;
  scoreDiv.textContent = "";
  shuffle(questions);
  showQuestion();
});

/* Start quiz (start screen button) */
startBtn.addEventListener('click', ()=>{
  // hide start screen, show question area
  startScreen.style.display = 'none';
  questionArea.style.display = 'block';
  // announce welcome
  try { selectedVoice = chooseFemaleVoice(); } catch(e){ selectedVoice = null; }
  speakHindi("рдЪрд▓реЛ, рд╣рдо рд╣рд┐рдВрджреА рдкреНрд░рд╢реНрдиреЛрддреНрддрд░реА рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред рддреИрдпрд╛рд░ рд╣реЛ рдЬрд╛рдЗрдПред");
  setTimeout(()=>{ playBtn.click(); }, 900);
});

/* Finish quiz */
function finishQuiz(){
  qText.textContent = "рдХреНрд╡рд┐рдЬрд╝ рд╕рдорд╛рдкреНрдд!";
  answerInput.disabled = true;
  submitBtn.disabled = true;
  passBtn.disabled = true;
  speakBtn.disabled = true;
  replayBtn.disabled = true;
  playBtn.disabled = true;
  statusDiv.style.color = "#000";
  statusDiv.textContent = "";
  scoreDiv.textContent = `рдЖрдкрдХрд╛ рд╕реНрдХреЛрд░: ${score} / ${questions.length}`;
  speakHindi(`рдХреНрд╡рд┐рдЬрд╝ рд╕рдорд╛рдкреНрддред рдЖрдкрдХрд╛ рд╕реНрдХреЛрд░ ${score} рдореЗрдВ рд╕реЗ ${questions.length} рд╣реИред`);
}

/* =====================
   Speech Recognition Setup
   ===================== */
let recognitionAvailable = false;
let recognition = null;
try{
  const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(Rec){
    recognition = new Rec();
    recognition.lang = "hi-IN";
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
    recognition.continuous = false;
    recognitionAvailable = true;

    recognition.onstart = ()=>{ statusDiv.style.color="#007bff"; statusDiv.textContent = "ЁЯОд рд╕реБрди рд░рд╣рд╛/рд░рд╣реА рд╣реВрдБ тАФ рдмреЛрд▓рд┐рдПред"; };
    recognition.onresult = (ev)=>{
      const text = ev.results[0][0].transcript.trim();
      console.log("Recognized:", text);
      answerInput.value = text;
      const expected = questions[current]._expected || [];
      if(checkAgainstList(text, expected)) correctAnswer();
      else wrongAnswer();
    };
    recognition.onerror = (e)=>{
      console.warn("Recognition error", e);
      statusDiv.style.color = "#b00020";
      if(e.error === "not-allowed" || e.error === "permission-denied"){
        statusDiv.textContent = "тЭМ рдорд╛рдЗрдХреНрд░реЛрдлрд╝реЛрди рдХреА рдЕрдиреБрдорддрд┐ рд░реЛрдХреА рдЧрдИ рд╣реИред рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕реЗрдЯрд┐рдВрдЧ рдореЗрдВ Allow рдХрд░реЗрдВред";
      } else if(e.error === "no-speech"){
        statusDiv.textContent = "ЁЯШ╢ рдЖрд╡рд╛рдЬрд╝ рдирд╣реАрдВ рдорд┐рд▓реА тАФ рдлрд┐рд░ рд╕реЗ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред";
      } else {
        statusDiv.textContent = "тЪая╕П рд╡реЙрдЗрд╕ рдЗрдирдкреБрдЯ рддреНрд░реБрдЯрд┐: " + (e.error || "unknown");
      }
    };
    recognition.onend = ()=>{ /* ended */ };

    speakBtn.addEventListener('click', ()=>{
      statusDiv.textContent = "";
      try{ recognition.start(); } catch(err){ statusDiv.textContent = "тЪая╕П рд╡реЙрдЗрд╕ рд╢реБрд░реВ рдХрд░рдиреЗ рдореЗрдВ рд╕рдорд╕реНрдпрд╛ред"; console.warn(err); }
    });
  } else {
    recognitionAvailable = false;
    statusDiv.textContent = "тЪая╕П рдЖрдкрдХрд╛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╡реЙрдЗрд╕ рдЗрдирдкреБрдЯ рдХреЛ рд╕рдкреЛрд░реНрдЯ рдирд╣реАрдВ рдХрд░рддрд╛ред (Chrome рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ)";
    speakBtn.disabled = true;
  }
}catch(err){
  recognitionAvailable = false;
  statusDiv.textContent = "тЪая╕П рд╡реЙрдЗрд╕ рдлрд╝реАрдЪрд░ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред";
  console.warn(err);
  speakBtn.disabled = true;
}

/* if no recognition, enable typing flow immediately */
if(!recognitionAvailable){
  answerInput.disabled = false;
  submitBtn.disabled = false;
  passBtn.disabled = false;
  replayBtn.disabled = false;
}

/* choose voice when voices load */
function setupVoices(){
  try{ const v = chooseFemaleVoice(); if(v) selectedVoice = v; console.log("Selected TTS voice:", selectedVoice && selectedVoice.name); } catch(e){ console.warn(e); }
}
if(typeof speechSynthesis !== "undefined"){
  if(speechSynthesis.getVoices().length === 0){
    speechSynthesis.onvoiceschanged = setupVoices;
  } else {
    setupVoices();
  }
}

/* show questions count */
scoreDiv.textContent = "рдХреБрд▓ рдкреНрд░рд╢реНрди: " + questions.length + " ┬╖ рдорд┐рд╢реНрд░рд┐рдд рд▓рд┐рдВрдЧ рдФрд░ рд╡рдЪрди";

/* allow keyboard Enter to submit */
answerInput.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter' && !submitBtn.disabled){
    submitBtn.click();
  }
});

/* End of script */
</script>
</body>
</html>
