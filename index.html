<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§ë‡§°‡§ø‡§Ø‡•ã ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‚Äî ‡§≤‡§ø‡§Ç‡§ó & ‡§µ‡§ö‡§® (30 ‡§™‡•ç‡§∞‡§∂‡•ç‡§®)</title>
<style>
  body{font-family: 'Noto Sans Devanagari', sans-serif; background:#f7fbff; margin:0; padding:28px; display:flex; justify-content:center;}
  .box{width:760px; max-width:95%; background:#fff; padding:24px; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.08);}
  h1{margin:0 0 10px 0; font-size:22px; color:#1b2b4a; text-align:center;}
  #questionText{font-size:20px; margin:18px 0; text-align:center; color:#111;}
  .controls{display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin:12px 0;}
  input[type="text"]{width:66%; padding:10px 12px; font-size:16px; border-radius:8px; border:1px solid #cfd8e3;}
  button{padding:10px 16px; font-size:15px; border:none; border-radius:8px; cursor:pointer; background:#007bff; color:#fff;}
  button.secondary{background:#6c757d;}
  #status{margin-top:10px; text-align:center; color:#b00020;}
  #score{margin-top:14px; text-align:center; font-weight:700; color:#1a7f3a;}
  .small{font-size:13px; color:#555; text-align:center; margin-top:6px;}
</style>
</head>
<body>
  <div class="box">
    <h1>üéß ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§ë‡§°‡§ø‡§Ø‡•ã ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‚Äî ‡§≤‡§ø‡§Ç‡§ó & ‡§µ‡§ö‡§® (30 ‡§™‡•ç‡§∞‡§∂‡•ç‡§®)</h1>
    <div id="questionText">Play ‡§¶‡§¨‡§æ‡§è‡§Å ‚Äî ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§∏‡•ç‡§µ‡§§‡§É ‡§™‡§¢‡§º‡•á ‡§ú‡§æ‡§è‡§Å‡§ó‡•á‡•§</div>

    <div style="display:flex;justify-content:center;gap:10px;align-items:center;flex-wrap:wrap;">
      <input id="answerInput" type="text" placeholder="‡§Ü‡§µ‡§æ‡§ú‡§º ‡§∏‡•á ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§â‡§§‡•ç‡§§‡§∞ ‡§Ø‡§π‡§æ‡§Å ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ ‚Äî ‡§Ø‡§æ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç" disabled />
    </div>

    <div class="controls">
      <button id="playBtn">üîä Play</button>
      <button id="speakBtn" disabled>üé§ Speak</button>
      <button id="submitBtn" disabled>Submit</button>
      <button id="passBtn" class="secondary" disabled>Pass</button>
      <button id="replayBtn" class="secondary" disabled>üîÅ Replay TTS</button>
    </div>

    <div id="status"></div>
    <div id="score"></div>
    <div class="small">‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞: Chrome (Desktop) ‡§Æ‡•á‡§Ç mic ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§Ç‡•§ ‡§Ø‡§¶‡§ø ‡§µ‡•â‡§á‡§∏ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§® ‡§π‡•ã ‡§§‡•ã ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡§ï‡•á ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§</div>
  </div>

<script>
/* ---------------------
  QUESTIONS (30 total)
  15 ‡§µ‡§ö‡§® (‡§¨‡§π‡•Å‡§µ‡§ö‡§® asked) + 15 ‡§≤‡§ø‡§Ç‡§ó (convert gender)
  Each item: {q: "text", a: [variants]}
----------------------*/
const questions = [
  // ‡§µ‡§ö‡§® (vachan) ‚Äî ask for plural
  { q: "‡§≤‡§§‡§æ ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§≤‡§§‡§æ‡§è‡§Å","‡§≤‡§§‡§æ‡§è‡§Ç","‡§≤‡§§‡§æ‡§Ø‡•á‡§Ç","‡§≤‡§§‡§æ‡§è‡§Å"] },
  { q: "‡§Æ‡§æ‡§§‡§æ ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§Æ‡§æ‡§§‡§æ‡§è‡§Å","‡§Æ‡§æ‡§§‡§æ‡§è‡§Ç"] },
  { q: "‡§™‡§æ‡§†‡§∂‡§æ‡§≤‡§æ ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§™‡§æ‡§†‡§∂‡§æ‡§≤‡§æ‡§è‡§Å","‡§™‡§æ‡§†‡§∂‡§æ‡§≤‡§æ‡§Ø‡•á‡§Ç","‡§™‡§æ‡§†‡§∂‡§æ‡§≤‡§æ‡§è‡§Ç"] },
  { q: "‡§ï‡•Å‡§∞‡•ç‡§∏‡•Ä ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§ï‡•Å‡§∞‡•ç‡§∏‡§ø‡§Ø‡§æ‡§Å","‡§ï‡•Å‡§∞‡•ç‡§∏‡§ø‡§Ø‡§æ‡§Ç","‡§ï‡•Å‡§∞‡•ç‡§∏‡•Ä‡§Ø‡§æ"] },
  { q: "‡§ò‡§°‡§º‡•Ä ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§ò‡§°‡§º‡§ø‡§Ø‡§æ‡§Å","‡§ò‡§°‡§º‡§ø‡§Ø‡§æ","‡§ò‡§°‡§ø‡§Ø‡§æ‡§Å","‡§ò‡§°‡§ø‡§Ø‡§æ"] },
  { q: "‡§∏‡§°‡§º‡§ï ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§∏‡§°‡§º‡§ï‡•ã‡§Ç","‡§∏‡§°‡§º‡§ï‡•á‡§Ç","‡§∏‡§°‡§º‡§ï‡•á‡§Ç"] , a:["‡§∏‡§°‡§º‡§ï‡•á‡§Ç","‡§∏‡§°‡§º‡§ï‡•á‡§Ç"] },
  { q: "‡§ï‡§ø‡§§‡§æ‡§¨ ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§ï‡§ø‡§§‡§æ‡§¨‡•á‡§Ç","‡§ï‡§ø‡§§‡§æ‡§¨‡•á‡§Ç","‡§ï‡§ø‡§§‡§æ‡§¨‡•ã‡§Ç"] },
  { q: "‡§≤‡§°‡§º‡§ï‡•Ä ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§≤‡§°‡§º‡§ï‡§ø‡§Ø‡§æ‡§Å","‡§≤‡§°‡§º‡§ï‡§ø‡§Ø‡§æ‡§Ç","‡§≤‡§°‡§º‡§ï‡§ø‡§Ø‡§æ‡§Å"] },
  { q: "‡§®‡§¶‡•Ä ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§®‡§¶‡§ø‡§Ø‡§æ‡§Å","‡§®‡§¶‡§ø‡§Ø‡§æ‡§Ç","‡§®‡§¶‡§ø‡§Ø‡§æ‡§Ç"] },
  { q: "‡§∞‡•ã‡§ü‡•Ä ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§∞‡•ã‡§ü‡§ø‡§Ø‡§æ‡§Å","‡§∞‡•ã‡§ü‡§ø‡§Ø‡§æ‡§Ç","‡§∞‡•ã‡§ü‡§ø‡§Ø‡§æ‡§Å"] },
  { q: "‡§ó‡§æ‡§°‡§º‡•Ä ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§ó‡§æ‡§°‡§º‡§ø‡§Ø‡§æ‡§Å","‡§ó‡§æ‡§°‡§º‡§ø‡§Ø‡§æ‡§Ç","‡§ó‡§æ‡§°‡§º‡§ø‡§Ø‡§æ‡§Å","‡§ó‡§æ‡§°‡§º‡§ø‡§Ø‡•ã‡§Ç","‡§ó‡§æ‡§°‡§ø‡§Ø‡§æ‡§Å"] },
  { q: "‡§ï‡§™‡§°‡§º‡§æ ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§ï‡§™‡§°‡§º‡•á","‡§ï‡§™‡§°‡•á","‡§ï‡§™‡§°‡•á‡§Ç"] },
  { q: "‡§¨‡§ö‡•ç‡§ö‡§æ ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§¨‡§ö‡•ç‡§ö‡•á","‡§¨‡§ö‡•ç‡§ö‡•ã‡§Ç","‡§¨‡§ö‡•ç‡§ö‡•á"] },
  { q: "‡§™‡•å‡§ß‡§æ ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§™‡•å‡§ß‡•á","‡§™‡•å‡§ß‡•ã‡§Ç","‡§™‡•å‡§ß‡•á"] },
  { q: "‡§´‡§≤ ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§´‡§≤","‡§´‡§≤","‡§´‡§≤"] },

  // ‡§≤‡§ø‡§Ç‡§ó (gender) ‚Äî ask for opposite gender
  { q: "‡§≤‡§°‡§º‡§ï‡§æ ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§∞‡•Ç‡§™ ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§≤‡§°‡§º‡§ï‡•Ä","‡§≤‡§°‡§ï‡•Ä","‡§≤‡§°‡§º‡•ç‡§ï‡•Ä"] },
  { q: "‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§∞‡•Ç‡§™ ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§Æ‡§æ‡§Å","‡§Æ‡§æ‡§Ç","‡§Æ‡§æ‡§§‡§æ"] },
  { q: "‡§™‡•Å‡§§‡•ç‡§∞ ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§∞‡•Ç‡§™ ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§™‡•Å‡§§‡•ç‡§∞‡•Ä","‡§™‡•Å‡§§‡•ç‡§∞‡•Ä"] },
  { q: "‡§ò‡•ã‡§°‡§º‡§æ ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§∞‡•Ç‡§™ ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§ò‡•ã‡§°‡§º‡•Ä","‡§ò‡•ã‡§°‡§º‡•Ä"] },
  { q: "‡§∂‡•á‡§∞ ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§∞‡•Ç‡§™ ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§∂‡•á‡§∞‡§®‡•Ä","‡§∂‡•á‡§∞‡§®‡•Ä"] },
  { q: "‡§®‡§∞ ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§∞‡•Ç‡§™ ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§®‡§æ‡§∞‡•Ä","‡§Æ‡§æ‡§¶‡§æ"] },
  { q: "‡§∂‡§ø‡§∑‡•ç‡§Ø ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§∞‡•Ç‡§™ ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§∂‡§ø‡§∑‡•ç‡§Ø‡§æ","‡§∂‡§ø‡§∑‡•ç‡§Ø‡§æ‡§É","‡§∂‡§ø‡§∑‡•ç‡§Ø‡•ç‡§Ø‡§æ"] },
  { q: "‡§®‡§æ‡§®‡§æ ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§∞‡•Ç‡§™ ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§®‡§æ‡§®‡•Ä","‡§®‡§æ‡§®‡•Ä"] },
  { q: "‡§∏‡•á‡§† ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§∞‡•Ç‡§™ ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§∏‡•á‡§†‡§æ‡§®‡•Ä","‡§∏‡•á‡§†‡§®‡•Ä","‡§∏‡•á‡§†‡§®‡•Ä"] },
  { q: "‡§™‡§§‡§ø ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§∞‡•Ç‡§™ ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§™‡§§‡•ç‡§®‡•Ä","‡§™‡§§‡•ç‡§®‡•Ä"] },
  { q: "‡§Æ‡•Å‡§∞‡§ó‡§æ ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§∞‡•Ç‡§™ ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§Æ‡•Å‡§∞‡§ó‡•Ä","‡§Æ‡•Å‡§∞‡•ç‡§ó‡•Ä","‡§Æ‡•Å‡§∞‡§ó‡§º‡•Ä"] },
  { q: "‡§∞‡§æ‡§ú‡§æ ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§∞‡•Ç‡§™ ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§∞‡§æ‡§®‡•Ä","‡§∞‡§æ‡§®‡•Ä"] },
  { q: "‡§Ü‡§¶‡§Æ‡•Ä ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§∞‡•Ç‡§™ ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§î‡§∞‡§§","‡§Æ‡§π‡§ø‡§≤‡§æ","‡§î‡§∞‡§§‡•á‡§Ç","‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä","‡§Æ‡§π‡§ø‡§≤‡§æ"] },
  { q: "‡§Ö‡§≠‡§ø‡§®‡•á‡§§‡§æ ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§∞‡•Ç‡§™ ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§Ö‡§≠‡§ø‡§®‡•á‡§§‡•ç‡§∞‡•Ä","‡§Ö‡§≠‡§ø‡§®‡•á‡§§‡•ç‡§∞‡•Ä"] },
  { q: "‡§≠‡§æ‡§à ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§∞‡•Ç‡§™ ‡§¨‡§§‡§æ‡§á‡§è", a:["‡§¨‡§π‡§®","‡§¨‡§π‡§®‡•á‡§Ç","‡§¨‡§π‡§®"] }
];

/* ensure exactly 30 items (user said 30) */
if(questions.length !== 30){
  console.warn("Questions count:", questions.length);
}

/* Shuffle questions */
function shuffle(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
}
shuffle(questions);

/* Elements */
const qText = document.getElementById('questionText');
const answerInput = document.getElementById('answerInput');
const playBtn = document.getElementById('playBtn');
const speakBtn = document.getElementById('speakBtn');
const submitBtn = document.getElementById('submitBtn');
const passBtn = document.getElementById('passBtn');
const replayBtn = document.getElementById('replayBtn');
const statusDiv = document.getElementById('status');
const scoreDiv = document.getElementById('score');

let current = 0, score = 0;
let lastSpoken = "";

/* Text-to-speech */
function speakHindi(text){
  lastSpoken = text;
  try{
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "hi-IN";
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  }catch(e){ console.warn(e); }
}

/* Normalization & fuzzy match helpers */
function normalizeDeva(s){
  if(!s) return "";
  s = s.normalize('NFD');
  // remove common combining marks (matras, virama, nukta) and punctuation/spaces
  s = s.replace(/[\u093C-\u094D\u0951-\u0954\u0962-\u0963\-\.\,\/\s\u0964\u0965'":;!?]/g,'');
  return s;
}
function levenshtein(a,b){
  if(a===b) return 0;
  a = a || ""; b = b || "";
  const al = a.length, bl = b.length;
  if(al===0) return bl;
  if(bl===0) return al;
  let v0 = new Array(bl+1), v1 = new Array(bl+1);
  for(let j=0;j<=bl;j++) v0[j]=j;
  for(let i=0;i<al;i++){
    v1[0]=i+1;
    for(let j=0;j<bl;j++){
      const cost = a[i]===b[j] ? 0 : 1;
      v1[j+1] = Math.min(v1[j]+1, v0[j+1]+1, v0[j]+cost);
    }
    for(let j=0;j<=bl;j++) v0[j]=v1[j];
  }
  return v1[bl];
}
function isMatch(recognized, correct){
  const r = normalizeDeva(recognized);
  const c = normalizeDeva(correct);
  if(!r || !c) return false;
  if(r === c) return true;
  const maxLen = Math.max(r.length, c.length);
  const threshold = Math.max(1, Math.floor(maxLen * 0.22)); // allow ~22% edits
  const dist = levenshtein(r, c);
  return dist <= threshold;
}
function checkAgainstList(recognized, list){
  for(const ans of list){
    if(isMatch(recognized, ans)) return true;
  }
  return false;
}

/* show question */
function showQuestion(){
  if(current >= questions.length){
    finishQuiz();
    return;
  }
  const q = questions[current].q;
  qText.textContent = q;
  answerInput.value = "";
  answerInput.disabled = false;
  submitBtn.disabled = false;
  passBtn.disabled = false;
  replayBtn.disabled = false;
  speakBtn.disabled = recognitionAvailable ? false : true;
  statusDiv.textContent = "";
  // speak automatically after a small pause
  setTimeout(()=>{ speakHindi(q); }, 300);
}

/* next question on correct */
function correctAnswer(){
  score++;
  statusDiv.style.color = "#1a7f3a";
  statusDiv.textContent = "‚úÖ ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞!";
  speakHindi("‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞");
  // move next after short delay
  setTimeout(()=>{ current++; showQuestion(); statusDiv.textContent = ""; }, 700);
}

/* wrong feedback */
function wrongAnswer(){
  statusDiv.style.color = "#b00020";
  statusDiv.textContent = "‚ùå ‡§ó‡§≤‡§§ ‡§â‡§§‡•ç‡§§‡§∞ ‚Äî ‡§™‡•Å‡§®‡§É ‡§¨‡•ã‡§≤‡•á‡§Ç ‡§Ø‡§æ 'Pass' ‡§¶‡§¨‡§æ‡§è‡§Å‡•§";
  speakHindi("‡§ó‡§≤‡§§ ‡§â‡§§‡•ç‡§§‡§∞");
}

/* submit typed */
submitBtn.addEventListener('click', ()=>{
  const val = answerInput.value.trim();
  if(!val){ statusDiv.style.color="#b00020"; statusDiv.textContent="‡§ï‡•É‡§™‡§Ø‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç"; return; }
  const correctList = questions[current].a;
  if(checkAgainstList(val, correctList)) correctAnswer();
  else wrongAnswer();
});

/* pass */
passBtn.addEventListener('click', ()=>{
  current++;
  statusDiv.textContent = "";
  if(current < questions.length) showQuestion(); else finishQuiz();
});

/* replay TTS */
replayBtn.addEventListener('click', ()=>{
  if(lastSpoken) speakHindi(lastSpoken);
});

/* play */
playBtn.addEventListener('click', ()=>{
  playBtn.textContent = "üîÅ Restart";
  current = 0; score = 0;
  scoreDiv.textContent = "";
  showQuestion();
});

/* finish */
function finishQuiz(){
  qText.textContent = "‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§!";
  answerInput.disabled = true;
  submitBtn.disabled = true;
  passBtn.disabled = true;
  speakBtn.disabled = true;
  replayBtn.disabled = true;
  playBtn.disabled = true;
  statusDiv.style.color = "#000";
  statusDiv.textContent = "";
  scoreDiv.textContent = `‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞: ${score} / ${questions.length}`;
  speakHindi(`‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡•§ ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞ ${score} ‡§Æ‡•á‡§Ç ‡§∏‡•á ${questions.length} ‡§π‡•à‡•§`);
}

/* ---------------------------
   Speech Recognition (Chrome)
   graceful fallback and status messages
   ---------------------------*/
let recognitionAvailable = false;
let recognition = null;

try {
  const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(Rec){
    recognition = new Rec();
    recognition.lang = "hi-IN";
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
    recognition.continuous = false;
    recognitionAvailable = true;

    recognition.onstart = ()=>{ statusDiv.style.color="#007bff"; statusDiv.textContent = "üé§ ‡§∏‡•Å‡§® ‡§∞‡§π‡§æ/‡§∞‡§π‡•Ä ‡§π‡•Ç‡§Å... ‡§¨‡•ã‡§≤‡§ø‡§è‡•§"; };
    recognition.onresult = (ev)=>{
      const text = ev.results[0][0].transcript.trim();
      console.log("Recognized:", text);
      answerInput.value = text;
      const correctList = questions[current].a;
      if(checkAgainstList(text, correctList)) correctAnswer();
      else wrongAnswer();
    };
    recognition.onerror = (e)=>{
      console.warn("Rec error", e);
      statusDiv.style.color = "#b00020";
      if(e.error === "not-allowed" || e.error === "permission-denied"){
        statusDiv.textContent = "‚ùå ‡§Æ‡§æ‡§á‡§ï‡•ç‡§∞‡•ã‡§´‡§º‡•ã‡§® ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§∞‡•ã‡§ï‡•Ä ‡§ó‡§à ‡§π‡•à‡•§ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó ‡§Æ‡•á‡§Ç Allow ‡§ï‡§∞‡•á‡§Ç‡•§";
      } else if(e.error === "no-speech"){
        statusDiv.textContent = "üò∂ ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä ‚Äî ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§";
      } else {
        statusDiv.textContent = "‚ö†Ô∏è ‡§µ‡•â‡§á‡§∏ ‡§á‡§®‡§™‡•Å‡§ü ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: " + (e.error || "unknown");
      }
    };
    recognition.onend = ()=>{ /* ended */ };

    speakBtn.addEventListener('click', ()=>{
      try{
        statusDiv.textContent = "";
        recognition.start();
      }catch(err){
        console.warn(err);
        statusDiv.textContent = "‚ö†Ô∏è ‡§µ‡•â‡§á‡§∏ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡•§";
      }
    });
  } else {
    recognitionAvailable = false;
    statusDiv.textContent = "‚ö†Ô∏è ‡§Ü‡§™‡§ï‡§æ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§µ‡•â‡§á‡§∏ ‡§á‡§®‡§™‡•Å‡§ü ‡§ï‡•ã ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§";
    speakBtn.disabled = true;
  }
} catch(err){
  recognitionAvailable = false;
  statusDiv.textContent = "‚ö†Ô∏è ‡§µ‡•â‡§á‡§∏ ‡§´‡§º‡•Ä‡§ö‡§∞ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§";
  console.warn(err);
  speakBtn.disabled = true;
}

/* If speech not available, enable typing flow */
if(!recognitionAvailable){
  answerInput.disabled = false;
  submitBtn.disabled = false;
  passBtn.disabled = false;
  replayBtn.disabled = false;
}

/* start button hint */
scoreDiv.textContent = "‡§ï‡•Å‡§≤ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®: " + questions.length + " ¬∑ ‡§≤‡§ø‡§Ç‡§ó + ‡§µ‡§ö‡§® ‡§Æ‡§ø‡§∂‡•ç‡§∞‡§ø‡§§";
</script>
</body>
</html>
