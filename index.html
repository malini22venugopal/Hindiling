<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§ë‡§°‡§ø‡§Ø‡•ã ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‚Äî ‡§≤‡§ø‡§Ç‡§ó & ‡§µ‡§ö‡§®</title>
<style>
  body{font-family:'Noto Sans Devanagari',sans-serif;background:#fffdf9;margin:0;padding:20px;text-align:center}
  h1{color:#b71c1c}
  #loginBox,#quizBox{max-width:500px;margin:auto}
  input{padding:10px;margin:6px;width:80%;font-size:1em;border:2px solid #ccc;border-radius:8px;text-align:center}
  button{margin:6px;padding:10px 15px;border:none;border-radius:8px;background:#1565c0;color:#fff;font-size:1em}
  button:hover{background:#0d47a1}
  #questionText{font-size:1.4em;margin:20px 0}
  #feedbackText{margin-top:10px;font-size:1.2em;font-weight:bold}
  #score{font-size:1.3em;margin-top:20px;color:#00695c}
</style>
</head>
<body>
<h1>‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§ë‡§°‡§ø‡§Ø‡•ã ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‚Äî ‡§≤‡§ø‡§Ç‡§ó & ‡§µ‡§ö‡§®</h1>

<!-- LOGIN SECTION -->
<div id="loginBox">
  <h2>‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</h2>
  <input id="nameInput" placeholder="‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"/>
  <input id="rollInput" placeholder="‡§∞‡•ã‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§Ø‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"/>
  <button id="loginBtn">‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§ï‡§∞‡•á‡§Ç</button>
</div>

<!-- QUIZ SECTION -->
<div id="quizBox" style="display:none">
  <div id="questionText">‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡•Ä‡§ö‡•á ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç</div>
  <input id="answerInput" placeholder="‡§â‡§§‡•ç‡§§‡§∞ ‡§¨‡•ã‡§≤‡•á‡§Ç ‡§Ø‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç"/>
  <div>
    <button id="submitBtn">‡§ú‡§æ‡§Å‡§ö‡•á‡§Ç</button>
    <button id="speakBtn">üéôÔ∏è ‡§¨‡•ã‡§≤‡•á‡§Ç</button>
    <button id="passBtn">‡§™‡§æ‡§∏</button>
    <button id="replayBtn">üîÅ ‡§¶‡•ã‡§π‡§∞‡§æ‡§è‡§Å</button>
  </div>
  <div><button id="playBtn">‚ñ∂Ô∏è ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button></div>
  <div id="feedbackText"></div>
  <div id="score"></div>
</div>

<script>
const vachanQuestions = [
  { word: "‡§≤‡§°‡§º‡§ï‡§æ", answers:["‡§≤‡§°‡§º‡§ï‡•á","‡§≤‡§°‡§º‡§ï‡•á‡§Ç"] },
  { word: "‡§ï‡§ø‡§§‡§æ‡§¨", answers:["‡§ï‡§ø‡§§‡§æ‡§¨‡•á‡§Ç"] },
  { word: "‡§∞‡•ã‡§ü‡•Ä", answers:["‡§∞‡•ã‡§ü‡§ø‡§Ø‡§æ‡§Å","‡§∞‡•ã‡§ü‡§ø‡§Ø‡§æ‡§Ç"] },
  { word: "‡§ï‡•Å‡§∞‡•ç‡§∏‡•Ä", answers:["‡§ï‡•Å‡§∞‡•ç‡§∏‡§ø‡§Ø‡§æ‡§Å","‡§ï‡•Å‡§∞‡•ç‡§∏‡§ø‡§Ø‡§æ‡§Ç"] },
  { word: "‡§∏‡•á‡§¨", answers:["‡§∏‡•á‡§¨"] },
  { word: "‡§ï‡§Æ‡§∞‡§æ", answers:["‡§ï‡§Æ‡§∞‡•á"] },
  { word: "‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞", answers:["‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞‡•á‡§Ç"] },
  { word: "‡§´‡§≤", answers:["‡§´‡§≤"] },
  { word: "‡§´‡•Ç‡§≤", answers:["‡§´‡•Ç‡§≤"] },
  { word: "‡§Ü‡§Æ", answers:["‡§Ü‡§Æ"] }
];
const lingQuestions = [
  { word: "‡§∞‡§æ‡§ú‡§æ", male:["‡§∞‡§æ‡§ú‡§æ"], female:["‡§∞‡§æ‡§®‡•Ä"] },
  { word: "‡§∞‡§æ‡§®‡•Ä", male:["‡§∞‡§æ‡§ú‡§æ"], female:["‡§∞‡§æ‡§®‡•Ä"] },
  { word: "‡§∂‡•á‡§∞", male:["‡§∂‡•á‡§∞"], female:["‡§∂‡•á‡§∞‡§®‡•Ä"] },
  { word: "‡§∂‡•á‡§∞‡§®‡•Ä", male:["‡§∂‡•á‡§∞"], female:["‡§∂‡•á‡§∞‡§®‡•Ä"] },
  { word: "‡§™‡§§‡§ø", male:["‡§™‡§§‡§ø"], female:["‡§™‡§§‡•ç‡§®‡•Ä"] },
  { word: "‡§™‡§§‡•ç‡§®‡•Ä", male:["‡§™‡§§‡§ø"], female:["‡§™‡§§‡•ç‡§®‡•Ä"] },
  { word: "‡§Æ‡•Å‡§∞‡•ç‡§ó‡§æ", male:["‡§Æ‡•Å‡§∞‡•ç‡§ó‡§æ"], female:["‡§Æ‡•Å‡§∞‡•ç‡§ó‡•Ä"] },
  { word: "‡§Æ‡•Å‡§∞‡•ç‡§ó‡•Ä", male:["‡§Æ‡•Å‡§∞‡•ç‡§ó‡§æ"], female:["‡§Æ‡•Å‡§∞‡•ç‡§ó‡•Ä"] },
  { word: "‡§™‡•Å‡§§‡•ç‡§∞", male:["‡§™‡•Å‡§§‡•ç‡§∞"], female:["‡§™‡•Å‡§§‡•ç‡§∞‡•Ä"] },
  { word: "‡§™‡•Å‡§§‡•ç‡§∞‡•Ä", male:["‡§™‡•Å‡§§‡•ç‡§∞"], female:["‡§™‡•Å‡§§‡•ç‡§∞‡•Ä"] },
  { word: "‡§Ö‡§ß‡•ç‡§Ø‡§æ‡§™‡§ï", male:["‡§Ö‡§ß‡•ç‡§Ø‡§æ‡§™‡§ï"], female:["‡§Ö‡§ß‡•ç‡§Ø‡§æ‡§™‡§ø‡§ï‡§æ"] },
  { word: "‡§Ö‡§ß‡•ç‡§Ø‡§æ‡§™‡§ø‡§ï‡§æ", male:["‡§Ö‡§ß‡•ç‡§Ø‡§æ‡§™‡§ï"], female:["‡§Ö‡§ß‡•ç‡§Ø‡§æ‡§™‡§ø‡§ï‡§æ"] }
];
let questions = [];
vachanQuestions.forEach(q=>questions.push({type:'vachan',...q}));
lingQuestions.forEach(q=>questions.push({type:'ling',...q}));
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}
shuffle(questions);

let current=0,score=0,voice=null,lastSpoken="";
const qText=document.getElementById("questionText");
const ans=document.getElementById("answerInput");
const submitBtn=document.getElementById("submitBtn");
const passBtn=document.getElementById("passBtn");
const replayBtn=document.getElementById("replayBtn");
const speakBtn=document.getElementById("speakBtn");
const playBtn=document.getElementById("playBtn");
const feedback=document.getElementById("feedbackText");
const scoreDiv=document.getElementById("score");

// === SPEECH SETUP ===
function chooseVoice(){
  const v=speechSynthesis.getVoices();
  const hi=v.filter(x=>/hi|hindi/i.test(x.lang||""));
  return hi.find(x=>/female|Aditi|Shruti|Google/.test(x.name))||hi[0]||v[0];
}
function speak(txt){
  lastSpoken=txt;
  const u=new SpeechSynthesisUtterance(txt);
  u.lang="hi-IN";u.rate=0.95;if(voice)u.voice=voice;
  speechSynthesis.cancel();speechSynthesis.speak(u);
}

// === NORMALIZATION & MATCH ===
function normalize(s){return (s||"").normalize("NFD").replace(/[\u093C-\u094D\u0964-\u0965\s\p{P}]/gu,"").toLowerCase();}
function lev(a,b){if(a===b)return 0;let m=[],al=a.length,bl=b.length;
  for(let i=0;i<=al;i++){m[i]=[i];for(let j=1;j<=bl;j++)m[i][j]=i===0?j:0;}
  for(let i=1;i<=al;i++){for(let j=1;j<=bl;j++){m[i][j]=a[i-1]===b[j-1]?m[i-1][j-1]:Math.min(m[i-1][j]+1,m[i][j-1]+1,m[i-1][j-1]+1);}}return m[al][bl];}
function match(a,b){a=normalize(a);b=normalize(b);return a===b || lev(a,b)<=1;}

// === QUIZ LOGIC ===
function nextQ(){
  if(current>=questions.length)return endQuiz();
  const q=questions[current];
  let prompt,expected;
  if(q.type==="vachan"){prompt=`‡§µ‡§ö‡§® ‡§¨‡§¶‡§≤‡§ø‡§è: ${q.word} ‡§ï‡§æ ‡§¨‡§π‡•Å‡§µ‡§ö‡§® ‡§¨‡§§‡§æ‡§á‡§è`;expected=q.answers;}
  else{
    if(["‡§∞‡§æ‡§®‡•Ä","‡§∂‡•á‡§∞‡§®‡•Ä","‡§™‡§§‡•ç‡§®‡•Ä","‡§Æ‡•Å‡§∞‡•ç‡§ó‡•Ä","‡§™‡•Å‡§§‡•ç‡§∞‡•Ä","‡§Ö‡§ß‡•ç‡§Ø‡§æ‡§™‡§ø‡§ï‡§æ"].includes(q.word))
      {prompt=`‡§≤‡§ø‡§Ç‡§ó ‡§¨‡§¶‡§≤‡§ø‡§è: ${q.word} ‡§ï‡§æ ‡§™‡•Å‡§≤‡•ç‡§≤‡§ø‡§Ç‡§ó ‡§¨‡§§‡§æ‡§á‡§è`;expected=q.male;}
    else{prompt=`‡§≤‡§ø‡§Ç‡§ó ‡§¨‡§¶‡§≤‡§ø‡§è: ${q.word} ‡§ï‡§æ ‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä‡§≤‡§ø‡§Ç‡§ó ‡§¨‡§§‡§æ‡§á‡§è`;expected=q.female;}
  }
  q._expected=expected;
  qText.textContent=prompt;ans.value="";feedback.textContent="";
  ans.disabled=false;submitBtn.disabled=false;passBtn.disabled=false;replayBtn.disabled=false;
  speak(prompt);
}

function correct(){
  score++;feedback.textContent="‚úÖ ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞! (Correct answer)";
  feedback.style.color="#1a7f3a";speak("‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞");
  setTimeout(()=>{current++;nextQ();},3500);
}
function wrong(){
  feedback.textContent="‚ùå ‡§ó‡§≤‡§§ ‡§â‡§§‡•ç‡§§‡§∞! (Wrong answer)";
  feedback.style.color="#c00";speak("‡§ó‡§≤‡§§ ‡§â‡§§‡•ç‡§§‡§∞");
}
submitBtn.onclick=()=>{
  const val=ans.value.trim();if(!val)return;
  const list=questions[current]._expected;
  if(list.some(x=>match(val,x)))correct();else wrong();
};
passBtn.onclick=()=>{current++;nextQ();};
replayBtn.onclick=()=>{if(lastSpoken)speak(lastSpoken);};
playBtn.onclick=()=>{current=0;score=0;shuffle(questions);nextQ();};

try{
  const R=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(R){
    const recognition=new R();recognition.lang="hi-IN";
    recognition.onresult=e=>{
      const txt=e.results[0][0].transcript.trim();
      ans.value=txt;
      const list=questions[current]._expected;
      if(list.some(x=>match(txt,x)))correct();else wrong();
    };
    speakBtn.onclick=()=>{try{recognition.start();}catch{}};
  }
}catch(e){console.warn(e);}

// === LOGIN SYSTEM ===
const loginBox=document.getElementById("loginBox");
const quizBox=document.getElementById("quizBox");
const loginBtn=document.getElementById("loginBtn");
loginBtn.onclick=()=>{
  const name=document.getElementById("nameInput").value.trim();
  const roll=document.getElementById("rollInput").value.trim();
  if(!name||!roll){alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§∞‡•ã‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç");return;}
  if(localStorage.getItem("quizDone_"+roll)){alert("‡§Ü‡§™‡§®‡•á ‡§™‡§π‡§≤‡•á ‡§π‡•Ä ‡§Ø‡§π ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§¶‡•á ‡§¶‡§ø‡§Ø‡§æ ‡§π‡•à!");return;}
  localStorage.setItem("quizUser",JSON.stringify({name,roll}));
  loginBox.style.display="none";quizBox.style.display="block";
  voice=chooseVoice();speechSynthesis.onvoiceschanged=()=>voice=chooseVoice();
};

// === END QUIZ ===
function endQuiz(){
  qText.textContent="‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§!";
  ans.disabled=true;submitBtn.disabled=passBtn.disabled=speakBtn.disabled=replayBtn.disabled=true;
  scoreDiv.textContent=`‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞: ${score} / ${questions.length}`;
  speak(`‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡•§ ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞ ${score} ‡§Æ‡•á‡§Ç ‡§∏‡•á ${questions.length} ‡§π‡•à‡•§`);
  const user=JSON.parse(localStorage.getItem("quizUser")||"{}");
  if(user.roll)localStorage.setItem("quizDone_"+user.roll,"true");

  // Send WhatsApp
  const msg=`Student: ${user.name || ''}%0aRoll No: ${user.roll || ''}%0aScore: ${score}/${questions.length}`;
  window.open(`https://wa.me/91999489****?text=${msg}`,'_blank');
}
</script>
</body>
</html>
